define(["jquery","core/ajax","core/notification","core/templates","core/modal_factory","core/modal_events","core/modal_save_cancel","block_remuiblck/dataTables.bootstrap4","theme_remui/jquery-asPieProgress","theme_remui/aspieprogress"],function(e,s,a,o,n,t){var r,i={ROOT:"",TABLE:"#DataTables_Teacher",DATA_TABLE:"#DataTables_Teacher_wrapper",STUDENT_PROGRESS_ELEMENT:".student_progress_ele",STUDENT_PROGRESS_TABLE:"#wdmCourseProgressTable",COURSE_NAME:".wdm_course_name.has-student",MESSAGE_HIDDEN:"#messageidhidden",MESSAGE_AREA:"#messagearea",TOGGLE_DESCRIPTION:".toggle-desc",REVERT:"#courserevertbtn",CUSTOM_MESSAGE:".custom-message",MESSAGE_SEND:".send-message",BLOCK_PROCESSING:".block-processing",ALWAYS_LOAD:"#always-load-progress",COURSE_PROGRESSING:".course-progress-settings",LOAD_COURSE_PROGRESS:"#load-progress",PANEL:".panel",PANEL_HEADING:".panel-heading",PANEL_ACTIONS:"panel-actions",BLOCK_PROCESSING:".block-processing",STUDENT_PROOGRESS_VISIBLE:"student-progress-visible"},l={coursesTable:!1,alwaysloadwarning:!1},d={GET_COURSES:function(e,a,o,n,t){return s.call([{methodname:"block_remuiblck_get_course_progress_list",args:{search:e,length:a,start:o,order:n,loadprogress:t}}])[0]},GET_COURSE_PROGRESS:function(e){return s.call([{methodname:"block_remuiblck_get_course_progress",args:{courseid:e}}])[0]},SEND_MESSAGE:function(e,a){return s.call([{methodname:"block_remuiblck_send_message",args:{studentid:e,messagetext:a}}])[0]}};function c(s){var a=e(i.ROOT);""!=s&&(a=a.find(s)),a.find(".pie-progress").asPieProgress({namespace:"pie-progress",speed:30,classes:{svg:"pie-progress-svg",element:"pie-progress",number:"pie-progress-number",content:"pie-progress-content"}})}function E(s,o){d.SEND_MESSAGE(s,o).done(function(s){e(i.ROOT).find(i.MESSAGE_HIDDEN).val(""),e(i.ROOT).find(i.MESSAGE_AREA).val(""),e(i.ROOT).find(".close-message").click()}).fail(function(s){a.exception(s),e(i.ROOT).find("div#analysis-chart-area").hide()})}function S(s){M.util.set_user_preference("always-load-progress",s),e(i.ROOT).find(i.COURSE_PROGRESSING).toggleClass("always-loading",s),e(i.ROOT).find(i.COURSE_PROGRESSING).toggleClass("load-progress",s),l.coursesTable.draw(!1)}function _(s){e("body").on("click",s+" "+i.COURSE_NAME,function(){!function(s){e(i.ROOT).find(i.BLOCK_PROCESSING).addClass("show"),d.GET_COURSE_PROGRESS(s).done(function(s){o.render("block_remuiblck/course_progress_view",s).done(function(s,a){e(i.ROOT).find(i.DATA_TABLE).hide(),o.replaceNodeContents(e(i.ROOT).find(i.STUDENT_PROGRESS_ELEMENT),s,a),c(i.STUDENT_PROGRESS_ELEMENT),r=e(i.ROOT).find(i.STUDENT_PROGRESS_TABLE).DataTable({scrollY:"300px",scrollCollapse:!0,paging:!1,retrieve:!0,lengthchange:!1,autoWidth:!0,scrollX:!0,search:"Fred",info:!1,language:{searchPlaceholder:"Search"},responsive:!0}),e(i.ROOT).find("div.dataTables_filter input").addClass("form-control"),e(i.ROOT).find("div.dataTables_length select").addClass("form-control"),e(i.ROOT).addClass(i.STUDENT_PROOGRESS_VISIBLE),e(i.ROOT).find(i.BLOCK_PROCESSING).removeClass("show"),e("html, body").animate({scrollTop:e(i.ROOT).offset().top-120},300)}).fail(function(e){console.log(e)})}).fail(function(s){e(i.ROOT).find("div#analysis-chart-area").hide()})}(e(this).data("courseid"))}).on("click",s+" "+i.REVERT,function(){r.destroy(),e(s).find(i.STUDENT_PROGRESS_ELEMENT).empty(),e(s).find(i.DATA_TABLE).show(),e(s).removeClass(i.STUDENT_PROOGRESS_VISIBLE),e("html, body").animate({scrollTop:e(i.ROOT).offset().top-120},300)}).on("click",s+" "+i.CUSTOM_MESSAGE,function(){var s=e(this).data("studentid");e(i.MESSAGE_HIDDEN).val(s)}).on("click",s+" "+i.MESSAGE_SEND,function(){var a=e(s).find(i.MESSAGE_HIDDEN).val(),o=e(s).find(i.MESSAGE_AREA).val();""!=o?E(a,o):e(i.MESSAGE_AREA).focus()}).on("click",i.STUDENT_PROGRESS_ELEMENT+" "+i.TOGGLE_DESCRIPTION,function(){e(this).toggleClass("fa-plus"),e(this).toggleClass("fa-minus"),e(this).parents(i.STUDENT_PROGRESS_ELEMENT).find(".panel-body").toggleClass("show")}).on("change",s+" "+i.ALWAYS_LOAD,function(){var s=e(this),a=e(this).is(":checked");!l.alwaysloadwarning&&a?n.create({type:n.types.SAVE_CANCEL,title:M.util.get_string("alwaysload","block_remuiblck"),body:M.util.get_string("alwaysloadwarning","block_remuiblck")}).then(function(e){var o=e.getRoot();o.on(t.save,function(){l.alwaysloadwarning=!0,M.util.set_user_preference("always-load-warning",!0),S(a),e.destroy()}),o.on(t.cancel,function(){s.prop("checked",!1)}),e.show()}):S(a)}).on("click",s+" "+i.LOAD_COURSE_PROGRESS,function(){e(s).find(i.COURSE_PROGRESSING).addClass("load-progress"),l.coursesTable.draw(!1)}),e(s+" "+i.TABLE).on("order.dt",function(){c("")}),e(s+" "+i.STUDENT_PROGRESS_TABLE).on("order.dt",function(){c("")})}return{init:function(s,o=!1){i.ROOT=s,l.alwaysloadwarning=o,e(document).ready(function(){!function(s){let a=e(s).find(i.COURSE_PROGRESSING).detach(),o=e(s).closest(i.PANEL).find(i.PANEL_HEADING),n=e(o).find("."+i.PANEL_ACTIONS);0==n.length&&(n=e('<div class="'+i.PANEL_ACTIONS+'"></div>'),o.prepend(n)),n.prepend(a),a.removeClass("d-none");let t=e(s).find(i.BLOCK_PROCESSING).detach();e(o).parent(i.PANEL).prepend(t)}(s),c(""),function(s){l.coursesTable=e(s).show().find(i.TABLE).DataTable({paging:!0,pagingType:"simple_numbers",autoWidth:!0,scrollX:!0,bPaginate:!0,bServerSide:!0,language:{searchPlaceholder:M.util.get_string("search","moodle"),emptyTable:M.util.get_string("nomatchingcourses","core_backup"),lengthMenu:M.util.get_string("show","moodle")+" _MENU_ "+M.util.get_string("entries","moodle"),paginate:{first:M.util.get_string("first","moodle"),previous:M.util.get_string("previous","moodle"),next:M.util.get_string("next","moodle"),last:M.util.get_string("last","moodle")}},ajax:function(o,n,t){e(s).find(i.BLOCK_PROCESSING).addClass("show");let r=e(s+" "+i.COURSE_PROGRESSING).is(".load-progress");d.GET_COURSES(o.search.value,o.length,o.start,o.order[0],r).done(function(a){if(0==a.recordsTotal)return a.data=[],n(a),void e(s).find(i.BLOCK_PROCESSING).removeClass("show");var o,t;a.data=(o=a.courses,t=[],o.forEach(function(e){var s={};s.index='<div class="w-50" tabindex="0">'+e.index+"</div>",e.enrolledStudents>0?s.course='<div class="wdm_course_name has-student" data-courseid="'+e.id+'"><a href="javascript:void(0)">'+e.fullname+"</a></div>":s.course='<div class="wdm_course_name" data-courseid="'+e.id+'" >'+e.fullname+"</div>",s.startdate=e.startdate,s.students='<div class="w-100"><span class="w-full pl-40">'+e.enrolledStudents+"</span></div>",-1==e.percentage?s.progress="":s.progress='<td class="w-100 px-10"><div class="pie-progress pie-progress-xs m-0 w-35" data-plugin="pieProgress" data-valuemax="50" data-barcolor="#11c26d" data-size="20" data-barsize="3" data-goal="35" aria-valuenow="'+e.percentage+'" role="progressbar" style="max-width: 35px!important;"><div class="pie-progress-content" style="z-index:2;"> </div> <span class=" progress-percent" style="margin-left: 50px;position: absolute;top: 8px;">'+e.percentage+"%</span> </div></td>",t.push(s)}),t),n(a),e(s).find(i.BLOCK_PROCESSING).removeClass("show")}).fail(a.exception)},columns:[{data:"index"},{data:"course"},{data:"startdate"},{data:"students",orderable:!1},{data:"progress",orderable:!1}],responsive:!0,drawCallback:function(e){c("")}})}(s),_(s)})}}});
//# sourceMappingURL=course_progress.min.js.map
