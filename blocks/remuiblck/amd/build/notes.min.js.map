{"version":3,"sources":["notes.js"],"names":["define","$","Ajax","course_id","student_count","user_id","course_name","SELECTORS","length","hide","on","this","children","attr","text","undefined","empty","call","methodname","args","courseid","done","response","Object","keys","show","append","M","util","get_string","each","index","student","id","fullname","fail","ex","html","message","find","val","notes_link","cfg","wwwroot"],"mappings":"AAAAA,OAAO,CAAC,SAAU,aAAc,SAASC,EAAGC,GAEvC,IAWOC,EAAWC,EAAeC,EAASC,EAXtCC,EACgB,oBADhBA,EAEgB,oBAFhBA,EAGU,aAHVA,EAIY,eAJZA,EAKc,iBALdA,EAMa,uBAEdN,EAAEM,GAA2BC,SAC7BP,EAAEM,GAA2BE,OAC7BR,EAAEM,GAAwBE,OAG1BR,EAAEM,EAA4B,WAAWG,GAAG,SAAU,WAIlD,GAHAT,EAAEM,GAA2BE,OAC7BN,EAAYF,EAAEU,MAAMC,SAAS,aAAaC,KAAK,MAC/CP,EAAcL,EAAEU,MAAMC,SAAS,aAAaE,YAC1BC,IAAdZ,EAGA,OAFAF,EAAEM,GAAwBS,aAC1Bf,EAAEM,GAAwBE,OAG9BP,EAAKe,KAAK,CAAC,CACPC,WAAY,+CACZC,KAAM,CACFC,SAAUjB,MAEd,GAAGkB,KAAK,SAASC,GACjBlB,EAAgBmB,OAAOC,KAAKF,GAAUd,OACtCP,EAAEM,GAAwBkB,OAC1BxB,EAAEM,GAAwBS,QACtBZ,GACAH,EAAEM,GAAwBmB,OAAO,WAAaC,EAAEC,KAAKC,WACjD,iBAAkB,mBAAqB,KAAOF,EAAEC,KAAKC,WAAW,QAAS,UACzE,KAAOzB,EAAgB,cAE3BH,EAAE6B,KAAKR,EAAU,SAAUS,EAAOC,GAC9B/B,EAAEM,GAAwBmB,OAAO,kBAAoBM,EAAQC,GAAK,KAAOD,EAAQE,SAAW,gBAIhGjC,EAAEM,GAAwBmB,OAAO,WAAaC,EAAEC,KAAKC,WAAW,0BAC5D,kBAAmBvB,GAAe,eAG3C6B,KAAK,SAASC,GACbnC,EAAEM,GAAwB8B,KAAK,WAAaD,EAAGE,QAAU,iBAIjErC,EAAEM,GAAwBG,GAAG,SAAU,WACnCT,EAAEM,GAA2BkB,OAC7BpB,EAAUJ,EAAEU,MAAM4B,KAAK,mBAAmBC,MAC1C,IAAIC,EAAad,EAAEe,IAAIC,QAAU,4BAA8BxC,EAC3D,WAAaE,EAAU,qBAC3BJ,EAAEM,EAA4B,IAAKA,GAAqBM,KAAK,OAAQ4B,GACrEA,EAAad,EAAEe,IAAIC,QAAU,4BAA8BxC,EACvD,WAAaE,EAAU,uBAC3BJ,EAAEM,EAA4B,IAAKA,GAAuBM,KAAK,OAAQ4B,GACvEA,EAAad,EAAEe,IAAIC,QAAU,4BAA8BxC,EACvD,WAAaE,EAAU,sBAC3BJ,EAAEM,EAA4B,IAAKA,GAAyBM,KAAK,OAAQ4B","sourcesContent":["define(['jquery', 'core/ajax'], function($, Ajax){\n     /* Add Notes Block */\n     var SELECTORS = {\n        ADD_NOTE_BUTTON: '.add-notes-button',\n        ADD_NOTE_SELECT: '.add-notes-select',\n        SITE_NOTE: '.site-note',\n        COURSE_NOTE: '.course-note',\n        PERSONAL_NOTE: '.personal-note',\n        STUDENT_LIST: '.select2-studentlist'\n     }\n    if ($(SELECTORS.ADD_NOTE_SELECT).length) {\n        $(SELECTORS.ADD_NOTE_BUTTON).hide();\n        $(SELECTORS.STUDENT_LIST).hide();\n        var course_id, student_count, user_id, course_name;\n\n        $(SELECTORS.ADD_NOTE_SELECT + ' select').on('change', function () {\n            $(SELECTORS.ADD_NOTE_BUTTON).hide();\n            course_id = $(this).children(\":selected\").attr(\"id\");\n            course_name = $(this).children(\":selected\").text();\n            if (course_id === undefined) {\n                $(SELECTORS.STUDENT_LIST).empty();\n                $(SELECTORS.STUDENT_LIST).hide();\n                return;\n            }\n            Ajax.call([{\n                methodname: 'block_remuiblck_get_enrolled_users_by_course',\n                args: {\n                    courseid: course_id\n                }\n            }])[0].done(function(response) {\n                student_count = Object.keys(response).length;\n                $(SELECTORS.STUDENT_LIST).show();\n                $(SELECTORS.STUDENT_LIST).empty();\n                if (student_count) {\n                    $(SELECTORS.STUDENT_LIST).append('<option>' + M.util.get_string(\n                        \"selectastudent\", \"block_remuiblck\") + ' (' + M.util.get_string(\"total\", \"moodle\") +\n                        ': ' + student_count + ')</option>');\n\n                    $.each(response, function (index, student) {\n                        $(SELECTORS.STUDENT_LIST).append('<option value=\"' + student.id + '\">' + student.fullname + '</option>');\n                    });\n\n                } else {\n                    $(SELECTORS.STUDENT_LIST).append('<option>' + M.util.get_string(\"nousersenrolledincourse\",\n                        \"block_remuiblck\", course_name) + '</option>');\n                }\n\n            }).fail(function(ex) {\n                $(SELECTORS.STUDENT_LIST).html('<option>' + ex.message + '</option>');\n            });\n        });\n\n        $(SELECTORS.STUDENT_LIST).on('change', function () {\n            $(SELECTORS.ADD_NOTE_BUTTON).show();\n            user_id = $(this).find('option:selected').val();\n            var notes_link = M.cfg.wwwroot + '/notes/edit.php?courseid=' + course_id +\n                '&userid=' + user_id + '&publishstate=site';\n            $(SELECTORS.ADD_NOTE_BUTTON + ' '+ SELECTORS.SITE_NOTE).attr('href', notes_link);\n            notes_link = M.cfg.wwwroot + '/notes/edit.php?courseid=' + course_id +\n                '&userid=' + user_id + '&publishstate=public';\n            $(SELECTORS.ADD_NOTE_BUTTON + ' '+ SELECTORS.COURSE_NOTE).attr('href', notes_link);\n            notes_link = M.cfg.wwwroot + '/notes/edit.php?courseid=' + course_id +\n                '&userid=' + user_id + '&publishstate=draft';\n            $(SELECTORS.ADD_NOTE_BUTTON + ' '+ SELECTORS.PERSONAL_NOTE).attr('href', notes_link);\n        });\n    }\n    /* End - Add Notes Block */\n});\n"],"file":"notes.min.js"}