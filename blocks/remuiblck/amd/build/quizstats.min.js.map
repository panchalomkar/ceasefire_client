{"version":3,"sources":["quizstats.js"],"names":["define","$","Ajax","SELECTORS","ROOT","CHART","CHART_AREA","COURSE_LIST","QUIZ_LIST","LIST_SELECTED","ERROR","barChart","getStepSize","datasets","current","max","forEach","data","index","Math","apply","ceil","createBarChart","course_id","getSelectedCourseID","quiz_id","getSelectedQuizID","call","methodname","args","courseid","quizid","done","response","undefined","find","hide","show","destroy","barcontext","get","getContext","canvas","height","barData","labels","Chart","type","options","responsive","maintainAspectRatio","scales","yAxes","scaleLabel","display","labelString","M","util","get_string","ticks","min","stepSize","fail","ex","initEvents","on","option","i","length","quizname","empty","append","init","root","document","ready"],"mappings":"AAAAA,OAAO,CAAC,SAAU,YAAa,gBAAiB,SAASC,EAAGC,GAExD,IAAIC,EAAY,CACZC,KAAM,KACNC,MAAO,YACPC,WAAY,mBACZC,YAAa,oBACbC,UAAW,aACXC,cAAe,kBACfC,MAAO,qBAEPC,EAAW,KAEXC,EAAc,SAASC,GACvB,IACIC,EADAC,EAAM,EAMV,OAJAF,EAASG,QAAQ,SAASC,EAAMC,GAC5BJ,EAAUK,KAAKJ,IAAIK,MAAMD,KAAMF,EAAKA,MACpCF,EAAMD,EAAUC,EAAMD,EAAUC,IAE7BI,KAAKE,KAAKN,EAAM,KAE3B,SAASO,IACL,IAAIC,EAAYC,IACZC,EAAUC,IAEdxB,EAAKyB,KAAK,CAAC,CACPC,WAAY,yCACZC,KAAM,CACFC,SAAUP,EACVQ,OAAQN,MAEZ,GACHO,KAAK,SAASC,GACX,QAA0BC,IAAtBD,EAASpB,SACTZ,EAAEE,EAAUC,MAAM+B,KAAKhC,EAAUG,YAAY8B,OAC7CnC,EAAEE,EAAUC,MAAM+B,KAAKhC,EAAUO,OAAO2B,WACrC,CACc,OAAb1B,GACAA,EAAS2B,UAEb,IAAIC,EAAatC,EAAEE,EAAUC,MAAM+B,KAAKhC,EAAUE,OAAOmC,IAAI,GAAGC,WAAW,MAC3EF,EAAWG,OAAOC,OAAS,IAE3B,IAAIC,EAAU,CACVC,OAAQZ,EAASY,OACjBhC,SAAUoB,EAASpB,UAEvBF,EAAW,IAAImC,MAAMP,EAAY,CAC7BQ,KAAM,MACN9B,KAAM2B,EACNI,QAAS,CACLC,YAAY,EACZC,qBAAqB,EACrBC,OAAQ,CACJC,MAAO,CAAC,CACJC,WAAY,CACRC,SAAS,EACTC,YAAaC,EAAEC,KAAKC,WAAW,eAAgB,oBAEnDC,MAAO,CACHC,IAAK,EACLC,SAAUjD,EAAYqB,EAASpB,oBAQ1DiD,KAAK,SAASC,GACX9D,EAAEE,EAAUC,MAAM+B,KAAKhC,EAAUG,YAAY8B,OAC7CnC,EAAEE,EAAUC,MAAM+B,KAAKhC,EAAUO,OAAO2B,SAIhD,IAAIb,EAAsB,WACtB,OAAOvB,EAAEE,EAAUC,MAAM+B,KAAKhC,EAAUI,YAAc,IAAMJ,EAAUM,eAAeQ,KAAK,aAE1FS,EAAoB,WACpB,OAAOzB,EAAEE,EAAUC,MAAM+B,KAAKhC,EAAUK,UAAY,IAAML,EAAUM,eAAeQ,KAAK,WAwBxF+C,EAAa,WACb/D,EAAEE,EAAUC,MAAM+B,KAAKhC,EAAUI,aAAa0D,GAAG,SAAU,WAvBpC,IACnB1C,EAAAA,EAAYC,IAChBtB,EAAKyB,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFC,SAAUP,MAEd,GACHS,KAAK,SAASC,GAEX,IADA,IAAIiC,EAAS,GACJC,EAAI,EAAGA,EAAIlC,EAASmC,OAAQD,IAEjCD,GADAA,EAASA,EAAS,oBAAsBjC,EAASkC,GAAGrC,SAAW,kBAAoBG,EAASkC,GAAGpC,OAAS,MACtFE,EAASkC,GAAGE,SAAW,YAE7CpE,EAAEE,EAAUC,MAAM+B,KAAKhC,EAAUK,WAAW8D,QAAQC,OAAOL,GAC3D5C,MAEHwC,KAAK,SAASC,GACX9D,EAAEE,EAAUC,MAAM+B,KAAKhC,EAAUG,YAAY8B,OAC7CnC,EAAEE,EAAUC,MAAM+B,KAAKhC,EAAUO,OAAO2B,WAO5CpC,EAAEE,EAAUC,MAAM+B,KAAKhC,EAAUK,WAAWyD,GAAG,SAAU,WACrD3C,OAaR,MAAO,CACHkD,KAVO,SAASC,GAChBtE,EAAUC,KAAOqE,EACjBxE,EAAEyE,UAAUC,MAAM,WACdX,IACI/D,EAAEE,EAAUC,MAAM+B,KAAKhC,EAAUE,OAAO+D,QACxC9C","sourcesContent":["define(['jquery', 'core/ajax', 'core/chartjs'], function($, Ajax){\n\n    var SELECTORS = {\n        ROOT: null,\n        CHART: \"#barChart\",\n        CHART_AREA: '#quiz-chart-area',\n        COURSE_LIST: '#quiz-course-list',\n        QUIZ_LIST: '#quiz-list',\n        LIST_SELECTED: 'option:selected',\n        ERROR: '.quiz-stats-error'\n    };\n    var barChart = null;\n    var respBar;\n    var getStepSize = function(datasets ) {\n        let max = 0;\n        let current;\n        datasets.forEach(function(data, index) {\n            current = Math.max.apply(Math, data.data);\n            max = current > max ? current : max;\n        });\n        return Math.ceil(max / 20);\n    };\n    function createBarChart() {\n        var course_id = getSelectedCourseID();\n        var quiz_id = getSelectedQuizID();\n\n        Ajax.call([{\n            methodname: 'block_remuiblck_get_quiz_participation',\n            args: {\n                courseid: course_id,\n                quizid: quiz_id\n            }\n        }])[0]\n        .done(function(response) {\n            if (response.datasets === undefined) {\n                $(SELECTORS.ROOT).find(SELECTORS.CHART_AREA).hide();\n                $(SELECTORS.ROOT).find(SELECTORS.ERROR).show();\n            } else {\n                if (barChart !== null) {\n                    barChart.destroy();\n                }\n                var barcontext = $(SELECTORS.ROOT).find(SELECTORS.CHART).get(0).getContext(\"2d\");\n                barcontext.canvas.height = 400;\n\n                var barData = {\n                    labels: response.labels,\n                    datasets: response.datasets\n                };\n                barChart = new Chart(barcontext, {\n                    type: 'bar',\n                    data: barData,\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        scales: {\n                            yAxes: [{\n                                scaleLabel: {\n                                    display: true,\n                                    labelString: M.util.get_string('noofstudents', 'block_remuiblck')\n                                },\n                                ticks: {\n                                    min: 0,\n                                    stepSize: getStepSize(response.datasets)\n                                }\n                            }]\n                        }\n                    }\n                });\n            }\n        })\n        .fail(function(ex) {\n            $(SELECTORS.ROOT).find(SELECTORS.CHART_AREA).hide();\n            $(SELECTORS.ROOT).find(SELECTORS.ERROR).show();\n        });\n    }\n\n    var getSelectedCourseID = function(){\n        return $(SELECTORS.ROOT).find(SELECTORS.COURSE_LIST + ' ' + SELECTORS.LIST_SELECTED).data('courseid');\n    }\n    var getSelectedQuizID = function(){\n        return $(SELECTORS.ROOT).find(SELECTORS.QUIZ_LIST + ' ' + SELECTORS.LIST_SELECTED).data('quizid');\n    }\n    var populateQuizSelector = function(){\n        var course_id = getSelectedCourseID();\n        Ajax.call([{\n            methodname: 'block_remuiblck_get_quizzes_of_course',\n            args: {\n                courseid: course_id\n            }\n        }])[0]\n        .done(function(response) {\n            var option = \"\";\n            for (var i = 0; i < response.length; i++) {\n                option = option + \"<option data-id='\" + response[i].courseid + \"' data-quizid='\" + response[i].quizid + \"'>\";\n                option = option + response[i].quizname + \"</option>\"\n            }\n            $(SELECTORS.ROOT).find(SELECTORS.QUIZ_LIST).empty().append(option);\n            createBarChart();\n        })\n        .fail(function(ex) {\n            $(SELECTORS.ROOT).find(SELECTORS.CHART_AREA).hide();\n            $(SELECTORS.ROOT).find(SELECTORS.ERROR).show();\n        });\n    }\n    var initEvents = function() {\n        $(SELECTORS.ROOT).find(SELECTORS.COURSE_LIST).on('change', function () {\n            populateQuizSelector();\n        });\n        $(SELECTORS.ROOT).find(SELECTORS.QUIZ_LIST).on('change', function () {\n            createBarChart();\n        });\n    };\n\n    var init = function(root) {\n        SELECTORS.ROOT = root;\n        $(document).ready(function() {\n            initEvents();\n            if ($(SELECTORS.ROOT).find(SELECTORS.CHART).length) {\n                createBarChart();\n            }\n        });\n    }\n    return {\n        init: init\n    };\n});\n"],"file":"quizstats.min.js"}