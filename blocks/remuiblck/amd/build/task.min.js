define(["jquery","core/ajax","core/notification","core/templates","core/modal_factory","core/modal_events","core/fragment","block_remuiblck/modal_task_popup","block_remuiblck/events","block_remuiblck/task_filters","block_remuiblck/task_view"],function(t,e,n,i,o,a,c,s,r,l,d){var u='[data-region="add-task"]',f='[data-region="task-item"]',k='[data-action="edit"]',g=".item-title .panel-heading span",m=".panel",p=".panel-heading",_="panel-actions",b="[aria-task-toasters]",h="aria-task-toasters",v=".block-processing",T=function(t){return e.call([{methodname:"block_remuiblck_create_new_task",args:t}])[0]},x=function(t){return e.call([{methodname:"block_remuiblck_edit_task",args:t}])[0]},y=function(t,n){return e.call([{methodname:"block_remuiblck_complete_task",args:{id:t,status:n}}])[0]},w=function(t){return e.call([{methodname:"block_remuiblck_delete_task",args:{id:t}}])[0]},C=function(t,n){return e.call([{methodname:"block_remuiblck_task_notify_users",args:{id:t,type:n}}])[0]},E=function(t){return c.loadFragment("block_remuiblck","task_form",contextid,{taskid:t})},A=function(t){t.hide(),t.destroy()},S=function(e,i,c){let s=function(e,n){let i=t(e).find(f+'[data-id="'+n+'"]');return i?i.find(g).text():n}(e,i);o.create({type:o.types.SAVE_CANCEL,title:M.util.get_string("deletetask","block_remuiblck"),body:M.util.get_string("deletetaskmessage","block_remuiblck",s)},t("#create")).done(function(o){o.setSaveButtonText(M.util.get_string("ok","moodle")),o.getRoot().on(a.save,function(){w(i).done(function(i){if(1==i.status)return A(o),A(c),j(e),void function(e,n,i,o){0==t(e).find("."+n+b).length&&t(e).append('<div class="toaster '+n+'"'+h+'role="alert"></div>');let a=t('<div class="toast toast-just-text '+i+' toast-shadow"><div class="toast-message">'+o+"</div></div>");t(e).find(b).append(a),setTimeout(function(){a.addClass("show")},0),setTimeout(function(){a.removeClass("show"),setTimeout(function(){a.remove()},250)},2e3)}(e,"toast-top-center","toast-error",M.util.get_string("taskdeleted","block_remuiblck",s));n.exception({name:i.msg})}).fail(n.exception)}).on(a.cancel,function(){A(o)}),o.show()}).fail(n.exception)},P=function(e,i){o.create({type:s.TYPE,templateContext:{new:-1==i}},t("#create")).done(function(t){t.show(),t.setBody(E(i)),t.getRoot().on(a.hidden,function(){A(t)}).on(r.TASK_SAVE,function(){if(!t.valid_settings())return;t.saving();let o=t.get_task_settings();-1!=i?(o.id=i,x(o).done(function(n){A(t),j(e)}).fail(function(e){t.saving(!1),n.exception(e)})):T(o).done(function(i){1!=o.notify?(A(t),j(e)):function(t,e){var i=arguments.length>1&&void 0!==arguments[2]?arguments[2]:null;C(t,e).done(i).fail(function(t){n.exception(t),null!=i&&i()})}(i,"create",function(){A(t),j(e)})}).fail(function(e){t.saving(!1),n.exception(e)})}).on(r.TASK_DELETE,function(){S(e,i,t)}).on(r.TASK_CANCEL,function(){A(t)})})},j=function(t){d.loadTasks(t,l.getTaskDuration(t),l.getTaskStatus(t))},K=function(e){t("body").on("click",u,function(){P(e,-1)}).on("click",e+" "+f,function(i){t(i.target).is("input")?function(e,i,o){d.toggleTaskProcessing(e,!0),y(i,o).done(function(a){1!=a.status?(t(e+" "+f+'[data-id="'+i+'"]').find("input").prop("checked",!o),n.exception({name:a.msg}),d.toggleTaskProcessing(e)):j(e)}).fail(function(a){n.exception(a),t(e+" "+f+'[data-id="'+i+'"]').find("input").prop("checked",!o),d.toggleTaskProcessing(e)})}(e,t(this).data("id"),t(i.target).is(":checked")):t(i.target).is(g)||(t(i.target).is(k)||t(i.target).parent().is(k))&&P(e,t(this).data("id"))})};return{init:function(e){t(document).ready(function(){K(e),function(e){let n=t(e).find(u).detach(),i=t(e).closest(m).find(p),o=t(i).find("."+_);0==o.length&&(o=t('<div class="'+_+'"></div>'),i.prepend(o)),o.prepend(n),n.removeClass("d-none");let a=t(e).find(v).detach();t(i).parent(m).prepend(a)}(e)}),d.init(e),l.init(e)}}});
//# sourceMappingURL=task.min.js.map
