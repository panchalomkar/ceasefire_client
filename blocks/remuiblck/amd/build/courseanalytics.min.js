define(["jquery","core/ajax","core/chartjs","core/custom_interaction_events","block_remuiblck/events"],function(a,t,e,n,i){var l={PAGECOUNT:"[data-action-page-count]",PAGINATE:"[data-action-paginate]",NEXT:"[data-next]",PREVIOUS:"[data-previous]",CHARTPAGINATION:".analysis-chart-pagination",PAGES:"[data-region-pages]",TOGGLELABELS:"#togglelabels",PER_PAGE_FILTER:'[data-region="per-page-filter"]',FILTER_OPTION:"[data-value]"};window.analysisChart=null;var s,r=1,o=1;function d(t,e){var n=function(a){var t={start:0,end:0};return null==s.labels?t:s.labels.length<=a?(t.start=1,t.end=s.labels.length,t):(t.start=1==r?1:(r-1)*a+1,t.end=r*a,s.labels.length<t.end&&(t.end=s.labels.length),t)}(e);a(t).find(l.PAGES).text(M.util.get_string("showingfromto","block_remuiblck",{start:n.start,to:n.end,total:s.labels.length})),analysisChart.data.labels=[],analysisChart.data.datasets.forEach(function(a){a.data=[]}),analysisChart.update();for(var i=n.start-1;i<=n.end;i++)analysisChart.data.labels.push(s.labels[i]),analysisChart.data.datasets.forEach(function(a,t){a.data.push(s.datasets[t].data[i])}),analysisChart.update()}function c(t,e){null!=s.labels?(r=1,a(t).find(l.CHARTPAGINATION).removeClass("d-none"),o=s.labels.length>e?Math.round(s.labels.length/e):1,d(t,e)):a(t).find(l.CHARTPAGINATION).addClass("d-none")}function u(n){(function(e){var n=a(e).find("#coursecategorylist option:selected").data("id");return t.call([{methodname:"block_remuiblck_get_course_analytics",args:{courseid:n}}])[0]})(n).done(function(t){s=t,r=1,null!==analysisChart&&analysisChart.destroy(),t.error?(a(n).find("#highestactivity").html(""),a(n).find("#lowestactivity").html(""),a(n).find("#highestgrade").html("0"),a(n).find("#lowestgrade").html("0"),a(n).find("#averagegrade").html("0")):(a(n).find("#highestactivity").html(s.maxactivityname),a(n).find("#lowestactivity").html(s.minactivityname),a(n).find("#highestgrade").html(s.highest),a(n).find("#lowestgrade").html(s.lowest),a(n).find("#averagegrade").html(s.average));var i=a(n).find("#analysischart").get(0).getContext("2d"),l=[];null!=t.datasets&&t.datasets.forEach(function(a){l.push({data:[],backgroundColor:a.backgroundColor,label:a.label})}),i.canvas.height=400,analysisChart=new e(i,{data:{labels:[],datasets:l},type:"bar",options:{responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!0},hover:{animationDuration:0},layout:{padding:{top:20}},legend:{position:"bottom",labels:{padding:20,fontSize:12}},animation:{duration:300,easing:"easeInOutQuad",onComplete:function(){var a=this.chart,t=a.ctx;t.font=e.helpers.fontString(e.defaults.global.defaultFontSize,e.defaults.global.defaultFontStyle,e.defaults.global.defaultFontFamily),t.textAlign="center",t.textBaseline="bottom",this.data.datasets.forEach(function(e,n){var i=a.controller.getDatasetMeta(n);1!=i.hidden&&i.data.forEach(function(a,n){var i=e.data[n];t.fillText(i,a._model.x,a._model.y-5)})})}},scales:{xAxes:[{display:!1,gridLines:{display:!0}}],yAxes:[{ticks:{beginAtZero:!0},gridLines:{display:!0}}]}}}),c(n,h(n))}).fail(function(t,e,i){a(n).find("div#analysis-chart-area").hide()})}var f=function(t){var e=a(t).find(l.PER_PAGE_FILTER);n.define(e,[n.events.activate]),e.on(n.events.activate,l.FILTER_OPTION,function(e,n){n.originalEvent.preventDefault();var s=a(e.target).closest(l.FILTER_OPTION);s.hasClass("active")||(a(e.target).trigger(i.COURSE_ANALYTICS_PAGE_FILTER_CHANGE),M.util.set_user_preference("courseanalyticsperpage",s.data("value")),c(t,s.data("value")))})},h=function(t){return a(t).find(l.PER_PAGE_FILTER).find(l.FILTER_OPTION+".active").data("value")};return{init:function(t){a(document).ready(function(){!function(t){f(t),a("body").on("click",t+" "+l.PAGINATE,function(){if(a(this).is(l.NEXT)){if(r==o)return;r++}else{if(!a(this).is(l.PREVIOUS))return;if(1==r)return;r--}var e=h(t);d(t,e)}),a("body").on("change",t+" #coursecategorylist",function(){u(t)})}(t),a(t).find("#analysischart").length&&u(t)})}}});
//# sourceMappingURL=courseanalytics.min.js.map
