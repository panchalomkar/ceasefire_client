define(["jquery","core/ajax","core/notification","core/modal_factory","core/modal_save_cancel","core/modal_events","block_remuiblck/manage_courses_view","block_remuiblck/manage_courses_filters","core/chartjs","block_remuiblck/jquery.dataTables","block_remuiblck/dataTables.bootstrap4"],function(e,t,a,o,s,n,r,i){var c=".remui-view-course-report",l="#wdm-userstats",d="#userstats-table",u="#userstats-table_wrapper .wdm-export-buttons",m=".wdm-manage-course-export-csv",g="#coursestats-chart",f="#userstats-table_filter input",b=".dropping-student-message",p=function(e){return t.call([{methodname:"block_remuiblck_get_course_report",args:{courseid:e}}])[0]},_=function(e,a,o,s,n){return t.call([{methodname:"block_remuiblck_get_dropping_off_students",args:{courseid:e,search:a,length:o,start:s,order:n}}])[0]},k=function(e,a){return t.call([{methodname:"block_remuiblck_export_dropping_off_students",args:{courseid:e,search:a}}])[0]},h=function(e,a){return t.call([{methodname:"block_remuiblck_send_message",args:{studentid:e,messagetext:a}}])[0]};e("body").on("click",c,function(){event.preventDefault();var t=this,s=e("#create-modal");o.create({title:e(t).attr("title")},s).done(function(o){o.modal.addClass("modal-lg"),o.getRoot().on(n.hidden,function(){o.destroy()}).addClass("fade"),o.setBody('<i class="fa fa-circle-o-notch fa-spin fa-fw" aria-hidden="true"></i>'),p(e(t).data("course-id")).done(function(e){if(o.setBody(e),0!=o.getRoot().find(g).length){var t=o.getRoot().find(g)[0].getContext("2d");new Chart(t,{type:"doughnut",data:{labels:[M.util.get_string("studentcompleted","block_remuiblck"),M.util.get_string("inprogress","block_remuiblck"),M.util.get_string("yettostart","block_remuiblck")],datasets:[{backgroundColor:[studentcompletedcolor,inprogresscolor,yettostartcolor],data:[o.getRoot().find(g).data("studentcompleted"),o.getRoot().find(g).data("inprogress"),o.getRoot().find(g).data("yettostart")]}]},options:{legend:{display:!1}}})}}).fail(a.exception),setTimeout(o.show(),100)})}).on("click",l,function(){e(d).is(".dataTable")||e(d).DataTable({bPaginate:!0,bServerSide:!0,language:{searchPlaceholder:M.util.get_string("searchnameemail","block_remuiblck"),emptyTable:M.util.get_string("nostudentsenrolled","block_remuiblck")},dom:'<"wdm-export-buttons">frtip',initComplete:function(t,a){e(u).append("<button class='wdm-manage-course-export-csv btn btn-primary' data-course-id='"+e(this).data("course-id")+"'>"+M.util.get_string("exportcsv","block_remuiblck")+"</button>")},ajax:function(t,o,s){_(e(this).data("course-id"),t.search.value,t.length,t.start,t.order[0]).done(function(e){o(e)}).fail(a.exception)},columns:[{className:"pb-0 pt-0",data:"name"},{className:"pb-0 pt-0",data:"email"},{className:"pb-0 pt-0",data:"enroltimestart"},{className:"pb-0 pt-0",data:"lastaccess"}],rowCallback:function(t,a,o){o%2==0?e(t).addClass("bg-grey-100"):e(t).addClass("bg-grey-200")}})}).on("click",m,function(){k(e(this).data("course-id"),e(f).val()).done(function(t){var a=e("<a></a>");e("body").append(a),e(a).attr("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t.filedata)),e(a).attr("download",t.filename).hide()[0].click(),e(a).remove()}).fail(a.exception)}).on("click",b,function(){var t=this,s=e("#create-modal");o.create({type:o.types.SAVE_CANCEL,title:M.util.get_string("sendmessage","core_message")},s).done(function(o){o.setSaveButtonText(M.util.get_string("send","core_message")),o.setBody("<label>"+M.util.get_string("sendmessageto","core_message",e(e(t).parent("td").siblings()[0]).html())+'</label><textarea class="form-control message" rows="5" autocomplete="off"></textarea>'),o.getRoot().on(n.hidden,function(){o.destroy()}),o.getRoot().on(n.save,function(s){var n=e(t).data("student-id"),r=e(this).find(".message").val();""!=r&&h(n,r).done(function(e){o.destroy()}).fail(function(e){a.exception(e)})}).addClass("modal-success fade"),o.modal.addClass("modal-center"),setTimeout(o.show(),100)})});return{init:function(t){e(document).ready(function(){r.init(t),i.init(t)})}}});
//# sourceMappingURL=manage_courses.min.js.map
