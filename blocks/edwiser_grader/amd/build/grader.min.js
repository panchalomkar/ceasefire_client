"use strict";define(["jquery","core/log","core/ajax","core/notification","core/templates","core/chartjs","core/modal_factory","core/modal_save_cancel","core/modal_events","core/fragment","block_edwiser_grader/jquery.dataTables","block_edwiser_grader/dataTables.bootstrap4","block_edwiser_grader/bootstrap-select","block_edwiser_grader/pagination"],function(e,t,a,d,i,n,r,o,s,l){return{init:function(t){e(document).ready(function(){var o,c,g,u=5,m=z("id"),p="",h="uaq",f="",b=1,_="",v="",k=z("gdm"),q="#edg-notgraded",x=!1;function w(t,i,n,r){var o=e("#edg-search-input").val();a.call([{methodname:t,args:{quizid:m,selectedattemptsfrom:i,selectedattempts:n,username:o,needsregrade:r}}])[0].done(function(t){e(".edg-notgraded-count").html("("+t.nongradedcount+")"),e(".edg-graded-count").html("("+t.gradedcount+")"),y("#edg-notgraded"==q?t.nongradedcount:t.gradedcount)}).fail(d.exception)}function y(t){t>u?e(q+" .edg-user-pages-container").pagination({dataSource:Array.from({length:t},function(e,t){return t+1}),pageSize:u,prevText:'<i class="fa fa-chevron-left" aria-hidden="true"></i>',nextText:'<i class="fa fa-chevron-right" aria-hidden="true"></i>',callback:function(e,t){var a;a=t.pageNumber,T("#edg-notgraded"==q?"block_edwiser_grader_get_not_graded_attempts":"block_edwiser_grader_get_graded_attempts",h,f,a,_,v)}}):e(".edg-user-pages-container").html("")}function C(){"#edg-notgraded"==q?(w("block_edwiser_grader_get_quiz_attempts",h,f,v),T("block_edwiser_grader_get_not_graded_attempts",h,f,b,_,v),e(".edg-close").trigger("click")):"#edg-graded"==q&&(w("block_edwiser_grader_get_quiz_attempts",h,f,v),T("block_edwiser_grader_get_graded_attempts",h,f,b,_,v),e(".edg-close").trigger("click"))}function T(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",c=e("#edg-search-input").val(),g=e("#edg-sort-box").val();a.call([{methodname:t,args:{quizid:m,selectedattemptsfrom:n,selectedattempts:r,page:o,username:c,sortfilter:g,soap:s,needsregrade:l}}])[0].done(function(t){!function(t){var a=[];t.map(function(e){return e.userurl=M.cfg.wwwroot+"/user/profile.php?id="+e.userid,e}),a.attempts=t,i.render("block_edwiser_grader/studenttable",a).then(function(a,d){i.replaceNode(e(q+" .edg-grader-attempt-table"),a,d),e(q+" .edg-ga-skeleton-content").hide(),e(q+" .edg-grader-attempt-table-content").show(),e(q+" .edg-attempt-link.active").each(function(t,a){e(a).trigger("shown.bs.tab")}),t.length>0?e(".edg-not-graded-filter").removeClass("edg-hidden"):e(".edg-not-graded-filter").addClass("edg-hidden")})}(t)}).fail(d.exception)}function z(e){var t,a,d=decodeURIComponent(window.location.search.substring(1)).split("&");for(a=0;a<d.length;a++)if((t=d[a].split("="))[0]===e)return void 0===t[1]||t[1]}function N(t,n){a.call([{methodname:"block_edwiser_grader_get_attempt_questions",args:{attemptid:t}}])[0].done(function(a){!function(t,a,d){var n=[];n.questionlist=t,i.render("block_edwiser_grader/studenttablequestions",n).then(function(t,n){var r=e(q+" .edg-question-container-"+a+" .edg-question-pill-container");i.replaceNode(r,t,n),e(q+" .edg-student-"+d).hide(),e(q+" .edg-question-container-"+a).css("display","flex"),S(e("#edg-switch-questions")),L(a),e(".edg-close").trigger("click")})}(a,t,n)}).fail(d.exception)}function S(t){"#edg-graded"!=q?e(t).is(":checked")?(e(".edg-question-pill").hide(),e(".edg-question-pill.requiresgrading").show()):(e(".edg-question-pill").show(),e(".edg-question-pill.notyetanswered, .edg-question-pill.answersaved").hide()):e(".edg-question-pill").show()}function A(t){var a=e(window).width(),d=e(q+" .edg-question-container-"+t+" .edg-question-pill-container").width();d==e(q+" .edg-question-container-"+t).width()&&a>1024&&(d-=110);var i=e(q+" .edg-question-container-"+t+" .edg-question-pill-container .edg-question-pill").width();return Math.floor(d/(i+15))}function L(t){var a=e(q+" .edg-question-container-"+t+' .edg-question-pill:not([style*="display: none"])'),d=A(t);if(a.length>=d+1){var i=a.length-d;e(q+" .edg-load-more-container-"+t+" .edg-lm-pill").html("+"+i+" "+M.util.get_string("more","block_edwiser_grader")),e(q+" .edg-load-more-container-"+t).show(),e(q+" .edg-load-more-container-"+t).hasClass("edg-vm")&&e(q+" .edg-question-container-"+t+" .edg-question-pill-container").addClass("expand")}else e(q+" .edg-load-more-container-"+t).hide()}function j(n,r,o,s){a.call([{methodname:"block_edwiser_grader_get_question_details",args:{slot:n,attemptid:r,cmid:o}}])[0].done(function(a){!function(a,d,n,r){var o=[],s=e(a.quedata),c=e(s).find(".felement.fhtmleditor textarea").val(),g=e(s).find(".responsehistoryheader .generaltable")[0].outerHTML;o.user=null!=a.user&&a.user,o.gdstate=a.gradestate,o.qnumber=d,o.qtype=a.questiontype,o.gdstateclass=a.gradestate.replace(/ /g,"").toLowerCase(),o.marks=a.marks,o.markshtml=e(s).find(".fcontainer .fitem:last-child")[0].outerHTML,e(s).find(".ablock").length?o.answer=e(s).find(".ablock").get(0).outerHTML:e(s).find(".formulation").length?o.answer=e(s).find(".formulation").get(0).outerHTML:e(s).find(".ddarea").length&&(o.answer=e(s).find(".ddarea").get(0).outerHTML),e(s).find(".qtext").length?o.questiontext=e(s).find(".qtext").get(0).outerHTML:o.questiontext=e(s).find(".formulation").get(0).outerHTML,o.state=e(s).find(".state").text(),o.gdinfo=e(s).find(".graderinfo").html(),o.qpaginate=null==r,o.upaginate=!o.qpaginate,o.queclass=e(s).attr("class"),o.jscode=a.jscode,o.slot=d,o.attemptid=n,e("#edg-grader-page .edg-user-grading").is(".edg-hide")||e("#edg-grader-page").animate({scrollTop:e("#edg-grader-page").scrollTop()+e(".edg-student-single-record.selected").position().top-20},300),e(".edg-question-details-section").addClass("show"),i.render("block_edwiser_grader/questiondetails",o).then(function(a,d){var o,s,u=e(".edg-question-details-section-content");i.replaceNode(u,a,d),setTimeout(function(){if(e(".edg-question").is(".multianswer")||e(".edg-question").is(".gapselect")){var t=e(".edg-question .edg-question-text");t.find("select option").attr("selected",!1),t.find("input").val("")}},0),l.loadFragment("block_edwiser_grader","comment_form",t,{commenttext:c}).done(function(t,a){i.replaceNode(e(".edg-comment-content"),t,a),e('[data-fieldtype="editor"]').find("i").removeAttr("title")}),e("#edg-response-history .modal-body").html(""),e("#edg-response-history .modal-body").append(g),null==r?D(e(q+" .edg-question-container-"+n),!0):(parent,o=r,e.each(o,function(t,a){"selected"==a.selected&&(s=a.id);var d=e("<option></option>").attr("data-slot",a.slot).attr("data-userid",a.userid).attr("data-attemptnum",a.attempt).attr("value",a.id).text(a.firstname+" "+a.lastname);e("#edg-students-select").append(d)}),e("#edg-students-select").val(s),attempt=e("#edg-students-select").find(":selected").attr("data-attemptnum"),e(".edg-sa-count").html(attempt),e("#edg-students-select").selectpicker("refresh"),J())})}(a,n,r,s)}).fail(d.exception)}function D(t,a){if(0!=e(t).length){var d=e(t).find('.edg-question-pill:not([style*="display: none"])'),i=[],n=[],r=1;e(d).each(function(t,a){var d=e(a).attr("data-attempt"),o=e(a).attr("data-qnumber");e(a).hasClass("selected")&&(r=t+1),i.push({attemptid:d,qnumber:o}),n.push(parseInt(o))}),p=e(".edg-pages-container").pagination({dataSource:n,pageSize:1,totalNumber:n.length,pageNumber:r,pageRange:4,prevText:'<i class="fa fa-chevron-left" aria-hidden="true"></i>',nextText:'<i class="fa fa-chevron-right" aria-hidden="true"></i>',callback:function(t,d){e(".edg-pages-container li.paginationjs-page").each(function(t,a){var d=e(a).find("a"),n=e(a).attr("data-num");if(void 0!==i[n-1]){var r=i[n-1].qnumber,o=i[n-1].attemptid;e(d).text(r),e(d).attr("data-qnumber",r),e(d).attr("data-attempt",o)}}),currentele=e(".edg-pages-container li.paginationjs-page.active a");var n=e(currentele).attr("data-qnumber"),r=e(currentele).attr("data-attempt");a?a=!1:H(n,r)}})}}function H(t,a){var d=z("id");o=t,c=a,j(t,a,d,null);var i=e(q+" .edg-question-container-"+c).parent();if(e(i).find(".edg-question-pill").removeClass("selected"),e(i).find(".edg-question-pill[data-qnumber="+t+"]").addClass("selected"),t>A(c)){var n=e(i).find(".edg-load-more-container-"+c+" button.edg-lm-pill:visible");0!=n.length&&e(n).trigger("click")}}function R(t,a,d,i){-1!=d&&(e(t).removeClass("correct partiallycorrect incorrect requiresgrading selected"),e(t).addClass(a),d=Math.floor(d)==d?Math.floor(d):d.toPrecision(0==Math.floor(d)?2:3),e(t).find(".edg-grade-status").html(d+" / "+i),e(".edg-marks-text").html(d+" / "+i)),0!=e(".edg-pages-container .paginationjs-next.disabled").length?e(".edg-close").trigger("click"):e(p).pagination("next")}function B(){e("input.edg-check-user:checked").length>0?(e(".edg-search-sort-menu").addClass("hide"),e(".edg-action-menu").removeClass("hide")):(e(".edg-search-sort-menu").removeClass("hide"),e(".edg-action-menu").addClass("hide"))}function I(t){a.call([{methodname:"block_edwiser_grader_dry_run_regrade",args:{cmid:m,dryrun:t}}])[0].done(function(t){e(".edg-snotification-text").html(t.regrade),e(".edg-notification-box.edg-success").addClass("edg-visible"),e(".edg-overlay").hide(),setTimeout(function(){e(".edg-notification-box.edg-success").removeClass("edg-visible"),location.reload()},1500)}).fail(d.exception)}function O(){var t=e("#edgfiltermodal .edg-filter-radio:checked").attr("data-filter"),a=e("#edgfiltermodal .edg-filter-state:not(:disabled):checked");return"unaq"==t||0!=a.length}function P(){var t=!1;e("#edg-filter-questions").is(":checked")&&(t=!0),a.call([{methodname:"block_edwiser_grader_question_based_grading",args:{cmid:m,includeauto:t}}])[0].done(function(t){!function(t){e("#eg-qb-table").DataTable().destroy();var a=e("#eg-qb-table").DataTable({bPaginate:!0,ordering:!0,lengthMenu:[10,20,50,100],pageLength:10,processing:!0,responsive:!0,language:{searchPlaceholder:M.util.get_string("searchquestion","block_edwiser_grader"),processing:'<i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw text-primary"></i>',emptyTable:M.util.get_string("noquestionsfound","block_edwiser_grader")},data:t,columns:[{className:"pb-0 pt-0 dt-center",data:"qnum"},{className:"pb-0 pt-0 dt-center",data:"qtypeicon"},{className:"pb-0 pt-0 dt-center",data:"qname"},{className:"pb-0 pt-0 dt-center edg-qb-grade",data:"qgrade"},{className:"pb-0 pt-0 dt-center edg-qb-grade",data:"qupdategrade"},{className:"pb-0 pt-0 dt-center edg-qb-grade",data:"qautograde"},{className:"pb-0 pt-0 dt-center edg-qb-grade",data:"qgradeall"}],createdRow:function(t,a,d){a.regradestatus&&e(t).addClass("edg-regrade")},columnDefs:[{targets:[1,2,3,4,5,6],orderable:!1}]});e("#eg-qb-table").css("visibility","visible"),a.column(5).visible(!1),e("#edg-filter-questions").is(":checked")&&a.column(5).visible(!0)}(t)}).fail(d.exception)}"user"==k&&(w("block_edwiser_grader_get_quiz_attempts",h,f,v),T("block_edwiser_grader_get_not_graded_attempts",h,f,b,_,v)),"question"==k&&(x=!0,P()),e("#edg-notgraded-tab").click(function(){q=e(this).attr("href"),w("block_edwiser_grader_get_quiz_attempts",h,f,v),T("block_edwiser_grader_get_not_graded_attempts",h,f,b,_,v),e(".edg-close").trigger("click")}),e("#edg-graded-tab").click(function(){q=e(this).attr("href"),w("block_edwiser_grader_get_quiz_attempts",h,f,v),T("block_edwiser_grader_get_graded_attempts",h,f,b,_,v),e(".edg-close").trigger("click")}),e("body").on("click",'[data-target="#edgfiltermodal"], [data-target="#edg-quiz-chart-modal"], [data-target="#edg-response-history"]',function(){e(e(this).data("target")).addClass("show")}),e("body").on("click","#edgfiltermodal .close, #edg-quiz-chart-modal .close, #edg-response-history .close",function(){e(this).closest(".modal").removeClass("show")}),e(document).on("click","#edg-search-btn",function(){C()}),e(document).on("keypress","#edg-search-input",function(e){13==e.which&&C()}),e(document).on("change","#edg-sort-box",function(){"#edg-notgraded"==q?(w("block_edwiser_grader_get_quiz_attempts",h,f,v),T("block_edwiser_grader_get_not_graded_attempts",h,f,b,_,v),e(".edg-close").trigger("click")):"#edg-graded"==q&&(w("block_edwiser_grader_get_quiz_attempts",h,f,v),T("block_edwiser_grader_get_graded_attempts",h,f,b,_,v),e(".edg-close").trigger("click"))}),e(document).on("shown.bs.tab",".edg-attempt-link",function(t){var a=e(t.target).attr("data-attempt"),d=e(t.target).attr("data-user"),i=e(t.target).attr("data-grade");void 0!==a&&(a=parseInt(a)),void 0!==d&&(d=parseInt(d)),e(q+" .edg-grade-"+d).text(i),e("body").css("margin-bottom","0px"),N(a,d),e(".edg-check-user").each(function(t,a){e(a).prop("checked",!1)}),e("#edg-check-all").prop("checked",!1),B()}),e("#edg-switch-questions").change(function(){S(e(this));var t=e(q+" .edg-question-pill.selected").attr("data-attempt"),a=e(q+" .edg-question-container-"+t);e(".edg-lm-pill").each(function(t,a){L(e(this).attr("data-attempt"))}),D(a,!0),0==e(".edg-question-pill.selected:visible").length&&e(".edg-close").trigger("click")}),e(window).resize(function(){e(".edg-lm-pill").each(function(t,a){L(e(this).attr("data-attempt"))}),"question"===k&&P()}),e(document).on("click",".edg-lm-pill, .edg-view-less",function(){var t=e(this).attr("data-attempt");e(q+" .edg-question-container-"+t+" .edg-question-pill-container").toggleClass("expand"),e(q+" .edg-question-container-"+t+" .edg-load-more").toggleClass("edg-vm")}),e(document).on("click",".edg-question-pill",function(){o=e(this).attr("data-qnumber"),c=e(this).attr("data-attempt"),g=z("id"),e(".edg-question-pill").removeClass("selected"),e(q+" .edg-student-single-record").removeClass("selected"),e(this).addClass("selected");var t=e(q+" .edg-question-container-"+c).parent(),a=t.offset().top;e("body").css("margin-bottom",a+"px"),e(t).addClass("selected"),e("html,body").delay(100).animate({scrollTop:a-5},100,"swing"),j(o,c,g,null)}),e(document).on("click",".edg-close",function(){e(".edg-question-pill").removeClass("selected"),e("body").css("margin-bottom","0px"),e(q+" .edg-student-single-record").removeClass("selected"),e(".edg-question-details-section").removeClass("show expand"),e(".generaltable tr").removeClass("highlighted")}),e(document).on("click",".edg-fullscreen",function(){e(".edg-question-details-section").toggleClass("expand"),e(".edg-fullscreen .fa").toggleClass("fa-expand").toggleClass("fa-compress")}),e(document).on("click",".edg-quiz-chart",function(){var t=z("id");a.call([{methodname:"block_edwiser_grader_display_grade_chart",args:{cmid:t}}])[0].done(function(t){respBar=e.parseJSON(JSON.stringify(t)),labels=respBar.labels.replace(/[[\]"]/g,""),data=respBar.data.replace(/[[\]]/g,"");var a=e("#edg-quiz-chart").get(0).getContext("2d");document.getElementById("edg-quiz-chart").height=500,a.canvas.height=400;var d={labels:labels.split(","),datasets:[{label:M.util.get_string("participants","block_edwiser_grader"),data:data.split(","),backgroundColor:"#87598E"}]};barChart=new n(a,{type:"bar",data:d,options:{responsive:!0,maintainAspectRatio:!1,scales:{xAxes:[{scaleLabel:{display:!0,labelString:M.util.get_string("grade","block_edwiser_grader")},ticks:{autoSkip:!1}}],yAxes:[{scaleLabel:{display:!0,labelString:M.util.get_string("participants","block_edwiser_grader")},stacked:!0,ticks:{min:0,stepSize:1}}]}}})}).fail(d.exception)}),e(document).on("keyup",'.edg-marks .felement.ftext input[type="text"]',function(){var t=e(this).attr("id");t=t.split("-");var a=parseFloat(e('input[name="'+t[0]+'-maxmark"]').val()),d=e(this).val();/^[0-9]\d*(\.\d+)?$/.test(d)&&d<=a||""==d.trim()?e(this).removeClass("error"):e(this).addClass("error")}),e(document).on("click",".edg-submit-btn",function(){e(".edg-spinner").show(),e(".edg-question-overlay").addClass("d-flex"),e(this).prop("disabled",!0);var t=Y.one("#id_comment_editor").get("value"),i=e('.edg-marks .felement.ftext input[type="text"]').val();""!=i&&(i=parseFloat(i)),""===i&&(i=-1);var n=e('.edg-marks .felement.ftext input[type="text"]').attr("id");n=n.split("-");var r,o=parseFloat(e('input[name="'+n[0]+'-maxmark"]').val());if(r=x?e("#edg-students-select").find(":selected").attr("data-userid"):e(".edg-student-single-record.selected").attr("data-studid"),e('.edg-marks .felement.ftext input[type="text"]').hasClass("error"))return e(".edg-question-overlay").removeClass("d-flex"),e(".edg-enotification-text").html(M.util.get_string("markserrormessage","block_edwiser_grader")),e(".edg-spinner").hide(),e(this).removeAttr("disabled"),e(".edg-notification-box.edg-error").addClass("edg-visible"),void setTimeout(function(){e(".edg-notification-box.edg-error").removeClass("edg-visible")},1500);!function(t,i,n,r,o,s){a.call([{methodname:"block_edwiser_grader_grade_question",args:{slot:t,attemptid:i,cmid:g,comment:n,marks:r,studid:o}}])[0].done(function(t){e(".edg-snotification-text").html(M.util.get_string("successupdatemsg","block_edwiser_grader")),e(".edg-grade-"+o).html(t.grade),e(".edg-notification-box.edg-success").addClass("edg-visible"),e(".edg-spinner").hide(),e(".edg-submit-btn").removeAttr("disabled"),setTimeout(function(){e(".edg-question-overlay").removeClass("d-flex"),e(".edg-notification-box.edg-success").removeClass("edg-visible"),x?0==e("#edg-students-select option:selected").next().length?(P(),e(".edg-close").trigger("click")):e(".edg-qb-userlist .edg-next").trigger("click"):R(e(".edg-question-pill.selected"),r==s?"correct":r>0&&r<s?"partiallycorrect":"incorrect",r,s)},1e3)}).fail(function(t){d.exception(t),e(".edg-question-overlay").removeClass("d-flex")})}(e(".edg-question-details-content .edg-question-number").text(),c,t,i,r,o)}),e(document).on("keypress",'.edg-marks .felement.ftext input[type="text"]',function(t){13==t.which&&e(".edg-submit-btn").trigger("click")}),e(document).on("change",".edg-check-user",function(){var t=e(this).attr("data-userid");e(this).is(":checked")?(e(".edg-overlay-"+t).show(),e(this).next().addClass("top")):(e(".edg-overlay-"+t).hide(),e(this).next().removeClass("top"),e("#edg-check-all").prop("checked",!1)),B()}),e(document).on("change","#edg-check-all",function(){e(this).is(":checked")?e(q+" input.edg-check-user").each(function(t,a){e(a).prop("checked",!0).trigger("change")}):e(q+" input.edg-check-user").each(function(t,a){e(a).prop("checked",!1).trigger("change")})}),e(".edg-delete-attempt").click(function(){var t=e("#edg-delete-confirmation");r.create({title:M.util.get_string("deleteboxheader","block_edwiser_grader"),type:r.types.SAVE_CANCEL,body:M.util.get_string("deletequestion","block_edwiser_grader")},t).done(function(t){t.setSaveButtonText(M.util.get_string("ok","block_edwiser_grader")),t.header.addClass("bg-danger"),t.header.children().addClass("text-white"),t.getRoot().on(s.hidden,function(){t.destroy()}),t.getRoot().on(s.save,function(t){var i;i=[],e.each(e(".edg-check-user:checked"),function(t,a){var d=e(a).attr("data-userid"),n=e(q+" .edg-record-"+d+" #edg-attempt-nav-tabcontent .tab-pane.active"),r=e(n).attr("data-attempt");i.push(r)}),a.call([{methodname:"block_edwiser_grader_delete_quiz_attempt",args:{attempts:JSON.stringify(i),quizid:m}}])[0].done(function(t){e(".edg-snotification-text").html(t.delete),e(".edg-notification-box.edg-success").addClass("edg-visible"),setTimeout(function(){e(".edg-notification-box.edg-success").removeClass("edg-visible"),location.reload()},1500)}).fail(d.exception)}),t.show()})}),e(document).on("change",".edg-filter-check",function(){e(this).is(":checked")?(e(this).next().next().addClass("edg-bolded"),"edg-check-finished"==e(this).attr("id")&&e("#edg-check-soau").removeAttr("disabled")):(e(this).next().next().removeClass("edg-bolded"),"edg-check-finished"==e(this).attr("id")&&e("#edg-check-soau").attr("disabled",!0))}),e(document).on("change",".edg-filter-radio",function(){e("#edg-sort-box option").show(),e("#edg-sort-box").val(1),e(".edg-filter-radio").next().next().removeClass("edg-bolded"),e(this).is(":checked")&&e(this).next().next().addClass("edg-bolded"),e("#edg-check-unaq").is(":checked")?(e('.edg-ra-filters input[type="checkbox"]').each(function(t,a){e(a).attr("disabled",!0)}),e("#edg-check-rg").attr("disabled",!0),e("#edg-sort-box").val(3),e('#edg-sort-box option[value="1"]').hide(),e('#edg-sort-box option[value="2"]').hide()):(e('.edg-ra-filters input[type="checkbox"]').each(function(t,a){e(a).removeAttr("disabled"),"edg-check-soau"!=e(a).attr("id")||e("#edg-check-finished").is(":checked")||e(a).attr("disabled",!0)}),e("#edg-check-rg").removeAttr("disabled"))}),e(document).on("click",".edg-data-download button.dropdown-item",function(){var t=e(this).val();e("select.edg-download-select").val(t),e("#edg-data-download-form").submit()}),e(".edg-regrade-attempt").click(function(){var t=[];e.each(e(".edg-check-user:checked"),function(a,d){var i=e(d).attr("data-userid"),n=e(q+" .edg-record-"+i+" #edg-attempt-nav-tabcontent .tab-pane.active"),r=e(n).attr("data-attempt");t.push(r)}),a.call([{methodname:"block_edwiser_grader_regrade_quiz_attempt",args:{attempts:JSON.stringify(t),cmid:m}}])[0].done(function(t){e(".edg-snotification-text").html(t.regrade),e(".edg-notification-box.edg-success").addClass("edg-visible"),setTimeout(function(){e(".edg-notification-box.edg-success").removeClass("edg-visible"),location.reload()},1500)}).fail(d.exception)}),e(".edg-dry-regrade-btn").click(function(){e(".edg-overlay-msg").html(M.util.get_string("dryruninprogress","block_edwiser_grader")),e(".edg-overlay").show(),I(!0)}),e(".edg-regrade-btn").click(function(){e(".edg-overlay-msg").html(M.util.get_string("regradeinprogress","block_edwiser_grader")),e(".edg-overlay").show(),I(!1)}),e("#edgfiltermodal .btn-primary").click(function(t){if(!O())return t.preventDefault(),t.stopPropagation(),void e(".edg-filter-error").removeClass("hide");h=e("#edgfiltermodal .edg-filter-radio:checked").attr("data-filter"),_=e("#edgfiltermodal #edg-check-soau:not(:disabled):checked").attr("data-filter"),v=e("#edgfiltermodal #edg-check-rg:not(:disabled):checked").attr("data-filter");var a=e("#edgfiltermodal .edg-filter-state:not(:disabled):checked").length;a&&(f=" AND (",e("#edgfiltermodal .edg-filter-state:not(:disabled):checked").each(function(t,d){f+=t===a-1?"qa.state = '"+e(this).attr("data-filter")+"' ":"qa.state = '"+e(this).attr("data-filter")+"' OR "}),f+=") "),e("#edg-notgraded-tab").trigger("click"),e("#edgfiltermodal").removeClass("show")}),e("#edgfiltermodal").on("hide.bs.modal",function(t){O()||(t.preventDefault(),t.stopPropagation(),e(".edg-filter-error").removeClass("hide"))}),e("#edgfiltermodal").on("show.bs.modal",function(t){e(".edg-filter-error").addClass("hide")}),e("#edg-grading-method").change(function(){e(".edg-close").trigger("click"),e(".edg-user-grading, .edg-question-grading").toggleClass("edg-hide"),x=!1,2==e(this).val()&&(x=!0),function(){if(history.pushState){var e=z("id"),t=window.location.protocol+"//"+window.location.host+window.location.pathname;t+=x?"?gdm=question&id="+e:"?gdm=user&id="+e,window.location=t}}()}),e("#edg-filter-questions").change(function(){P()});var E="";function F(e,t,a){e.map(function(e){return e.selected=e.id==t?"selected":"",e}),E=e}function J(){var t=e("#edg-students-select option:selected");e(".edg-qb-userlist .edg-prev, .edg-qb-userlist .edg-next").removeClass("disabled"),0==t.prev().length&&e(".edg-qb-userlist .edg-prev").addClass("disabled"),0==t.next().length&&e(".edg-qb-userlist .edg-next").addClass("disabled")}e(document).on("click",".edg-qb-grade a",function(t){t.preventDefault(),e("#eg-qb-table tbody tr").removeClass("highlighted"),e(this).parent().parent().addClass("highlighted");var i=e(this).offset().top;e("body").css("margin-bottom",i+"px"),e("html,body").animate({scrollTop:i-45},250,"swing"),o=e(this).data("slot");var n=e(this).data("mode"),r=e(this).data("qid");a.call([{methodname:"block_edwiser_grader_question_based_grading_details",args:{cmid:m,slots:"string"==typeof o?o.split(","):[o],mode:n,qid:r}}])[0].done(function(e){e.length>=1&&(F(e,c=e[0].id),j(e[0].slot,c,g,E))}).fail(d.exception)}),e(document).on("change","#edg-students-select",function(){c=e(this).val(),o=e(this).find(":selected").attr("data-slot"),F(E,c),j(o,c,m,E)}),e(document).on("click",".edg-qb-userlist .edg-prev",function(){var t=e("#edg-students-select option:selected");if(0!=t.prev().length){var a=t.prev().val();e("#edg-students-select").val(a).change(),J()}}),e(document).on("click",".edg-qb-userlist .edg-next",function(){var t=e("#edg-students-select option:selected");if(0!=t.next().length){var a=t.next().val();e("#edg-students-select").val(a).change(),J()}}),e(document).on("blur",".form-control.atto_image_urlentry",function(){e(this).parents("form.atto_form").addClass("image-properties")}),e("body").on("click",function(t){e(".bootstrap-select").removeClass("open")})})}}});