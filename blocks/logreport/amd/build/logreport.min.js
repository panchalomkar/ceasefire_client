define(["jquery","block_logreport/datatables","block_logreport/select2"],function(a,b,c){var d,e={FORM:".logselecform",COURSE:"#menuid",MODULE:"#menumodid",USER:"#menuuser",CLEAR:"#lr_clearfilter"};return d={Init:function(){a("select[data-select2='1']").select2(),a(e.CLEAR).on("click",function(b){a(e.FORM).trigger("reset"),a(e.COURSE).trigger("change"),a("select[data-select2='1']").select2("destroy").select2(),a(".generaltable[data-datatable=true]").DataTable().destroy(),d.InitDatatable()}),a(e.COURSE).on("change",function(b){if(a(e.MODULE).find("option").not(":first").remove(),a(e.MODULE).find("optgroup").remove(),a(this).hasClass("cousrefilter")){var c=a(this).val();a.ajax({url:M.cfg.wwwroot+"/blocks/logreport/ajax.php?courseid="+c}).done(function(b){var d=b;1==c?a.each(d.activities,function(b,c){a("<option value="+b+">"+c+"</option>").appendTo(a(e.MODULE))}):a.each(d.activities,function(b,c){a.each(c,function(b,c){var d=a("<optgroup>",{label:b});a(d).appendTo(a(a(e.MODULE))),a.each(c,function(b,c){a("<option value="+b+">"+c+"</option>").appendTo(d)})})}),a(e.MODULE).select2("destroy").select2()})}})},ProcessFilter:function(){a(".logselecform").submit(function(b){b.preventDefault();var c=a(this).serializeArray();a(".generaltable[data-datatable=true]").DataTable().destroy(),d.InitDatatable(c)})},InitDatatable:function(b){var c={};if("undefined"==typeof b)var c={};else a.each(b,function(a,b){c[b.name]=b.value});a(".generaltable[data-datatable=true]").DataTable({dom:"<l<t>ip>",ordering:!1,processing:!0,serverSide:!0,ajax:{type:"POST",url:M.cfg.wwwroot+"/blocks/logreport/server_processing.php",data:c}})}}});