{"version":3,"sources":["coursecategorylayout1.js"],"names":["define","$","Ajax","str","templates","toolbar","Notification","filterobj","langstrings","categoryfilter","cardswrapperarea","cardspagination","pageheaderactions","gridtemplate","searchfilter","coursecounter","tagswrapper","updatePage","empty","pagination","generateCourseCards","populate_tags","call","methodname","args","data","JSON","stringify","done","response","append","fail","exception","isFilterModified","show","parse","hasmanagebutton","managebuttons","undefined","dropdown","remove","rendertemplate","courses","latest_card","addClass","text","totalcoursescount","length","i","render","then","html","js","appendNodeContents","each","this","content","style","htmldata","getCourses","document","delegate","window","location","attr","on","e","category","target","value","initPagination","history","replaceState","title","M","cfg","wwwroot","encodeURI","preventDefault","search","val","tab","checked","linkdata","href","parentElement","hash","hashes","slice","indexOf","split","vars","push","page","mycourses","init","defaultCategory","event","trigger","get_strings","key","component","stringres","_pageobj","_obj","sort","initAttributes","categoryFilters","filterdata","categoryid","categorysort","hasClass","prop"],"mappings":"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","sourcesContent":["\"use strict\";\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/str',\n    'core/templates',\n    'theme_remui/jquery-toolbar',\n    'core/notification'\n], function ($, Ajax, str, templates, toolbar, Notification) {\n\n    // Globals.\n    var filterobj;\n    var langstrings;\n\n    var categoryfilter = $('#categoryfilter .categoryselector');\n\n    var categorylink = '[category-filter-link]';\n\n    var cardswrapperarea = $('.course-cards');\n    var cardspagination = $('.cards-pagination');\n\n    var pageheaderactions = '.page-header-actionss';\n    // View templates.\n    var gridtemplate = 'theme_remui/course_card_grid';\n\n    var searchfilter = $('#categoryfilter .simplesearchform .simplesearchform');\n    \n    var mycoursescheckbox = $('.custom-switch');\n\n    var coursecounter = $('.course-counter span.course-number');\n\n    var tagswrapper = $('.course-tags .tag-wrapper');\n    /**\n     * Main category filters class.\n     * @param  {Integer} defaultCategory Default category to select.\n     * @return {Object}  Filter object\n     */\n    var categoryFilters = function(defaultCategory) {\n\n        var _pageobj = {courses: 0, mycourses: 0};\n        var _obj = {\n            // Category id.\n            category: defaultCategory,\n            // Sorting.\n            sort: 'ASC',\n            // Searching string.\n            search: \"\",\n            // If true, means mycourses tab is active.\n            tab: false,\n            // This object consist of page number that is currently active, has mycourses and all courses tab page number.\n            page: _pageobj,\n            // If True, regenerate the pagination on any action performed.\n            pagination: true,\n            // Initially it is null to detect initial change in view, String grid - view in grid format, String list - list format.\n            // view: null,\n            // This filterModified true will tell that we need to fetch the courses otherwise show old fetched data.\n            isFilterModified: true\n        };\n\n        _obj.initAttributes = function() {\n            _obj.category = defaultCategory;\n            _obj.sort = 'ASC';\n            _obj.search = '';\n            _obj.tab = false;\n            _obj.page = _pageobj;\n            _obj.pagination = true;\n            // _obj.view = null;\n            _obj.isFilterModified = true;\n        };\n\n        _obj.initPagination = function() {\n            _obj.page = {courses: 0, mycourses: 0};\n        };\n        return _obj;\n    }\n\n\n    /**\n     * Filters Generation\n     * @param  {Object} filterdata Filter data\n     */\n    function generateFilters(filterdata) {\n        // $(\".selectpicker\").each(function() {\n        //     $(this).selectpicker();\n        // });\n        if (filterdata.category !== \"\") {\n            $(\"#categoryfilter .categoryselector\").val(filterdata.category);\n        }\n\n        if (filterdata.tab == true) {\n            $('#switch-label1, #switch-label2').prop('checked', true);\n        } else {\n            $('#switch-label1, #switch-label2').prop('checked', false);\n        }\n\n        // if (filterdata.sort !== null) {\n        //     $(\"#sortfilter.selectpicker\").selectpicker('val', filterdata.sort);\n        // }\n\n        if (filterdata.search !== \"\") {\n            $(\"#coursesearchbox\").val(filterdata.search);\n        }\n\n        // Put animation over here.\n        // $(\".category-filters\").removeClass('d-none');\n    }\n\n    /**\n     * Update page content\n     */\n    function updatePage() {\n        // Destroy the cards from page.\n        destroyCourseCards();\n        // Create courses cards again.\n        generateCourseCards();\n    }\n\n    /*\n     * Populate the tags section.\n     */\n    function populate_tags(){\n        var serviceName = 'theme_remui_get_tags';\n        var getcourses = Ajax.call([{\n            methodname: serviceName,\n            args: {\n                data: JSON.stringify(filterobj)\n            }\n        }]);\n        getcourses[0].done(function(response) {\n            tagswrapper.empty().append(response);\n        }).fail(Notification.exception);\n    }\n\n    /**\n     * Course cards initialization function.\n     */\n    function generateCourseCards() {\n        // Check if Filters are modified and need to fetch the courses.\n        if (!filterobj.isFilterModified) {\n            return;\n        }\n        // Fetch the courses.\n        getCourses();\n    }\n    /**\n     * Destroy courses cards\n     */\n    function destroyCourseCards() {\n        // Find active tab to append the course cards.\n        // var destroytab = (filterobj.tab) ? mycoursesregion : coursesregion;\n        // Empty the courses region.\n        $(cardswrapperarea).empty();\n\n        // Destroy the pagination also.\n        if (filterobj.pagination) {\n            // var destroypagination = (filterobj.tab) ? mycoursespagination : coursespagination;\n            // $(destroypagination).empty();\n            cardspagination.empty();\n        }\n    }\n\n    /**\n     * Ajax to fetch the course and also append those courses to the page.\n     * If pagination is enabled it will also generate new pagination.\n     */\n    function getCourses() {\n        $('.courses-tabs .courses-loader-wrap').show();\n        // Find active tab to append the course cards.\n        // var appendtab = (filterobj.tab) ? mycoursesregion : coursesregion;\n        // var appendpagination = (filterobj.tab) ? mycoursespagination : coursespagination;\n        var serviceName = 'theme_remui_get_courses';\n        var getcourses = Ajax.call([{\n            methodname: serviceName,\n            args: {\n                data: JSON.stringify(filterobj)\n            }\n        }]);\n        getcourses[0].done(function(response) {\n            response = JSON.parse(response);\n\n            // Empty the action button on top header, and add new ones.\n            $(pageheaderactions).empty();\n            if (response.hasmanagebutton == true) {\n                $(pageheaderactions).append(response.managebuttons);\n            }\n\n            // Show category management dropdown button when user has 'moodle/category:manage' capability.\n            if (response.dropdown != undefined) {\n                $('#page-header .page-header-actionss').append(response.dropdown);\n            } else {\n                $('#page-header .page-header-actionss [data-enhance=\"moodle-core-actionmenu\"]').remove();\n            }\n\n            // Get the view.\n            // var viewobj = (filterobj.view === null) ? response.view : filterobj.view;\n            var viewobj = 'grid'; // View is always in grid form.\n\n            // Select the template to render according to view.\n            // var rendertemplate = (viewobj == 'grid' || response.latest_card) ? gridtemplate : listtemplate;\n            var rendertemplate = gridtemplate;\n\n            // Always render grid teplate on mobile screen and when latest cards setting is on.\n            // if (window.screen.width <= 480 || response.latest_card) {\n            //     rendertemplate = gridtemplate;\n            //     viewobj = 'grid';\n            // }\n\n            // Update the view.\n            // updateView(viewobj);\n\n            // updateCards(response.latest_card);\n\n            var courses = response.courses;\n            if (response.latest_card) {\n                cardswrapperarea.addClass('latest-cards');\n            }\n            $(coursecounter).text(response.totalcoursescount);\n            if (courses.length > 0) {\n                for (var i = 0; i < courses.length; i++) {\n                    // This will call the function to load and render our template.\n                    templates.render(rendertemplate, courses[i])\n                    // It returns a promise that needs to be resoved.\n                    /* eslint no-loop-func: 0 */\n                    .then(function(html, js) {\n                        // Here eventually I have my compiled template, and any javascript that it generated.\n                        // The templates object has append, prepend and replace functions.\n                        // templates.appendNodeContents(appendtab, html, js);\n                        templates.appendNodeContents(cardswrapperarea, html, js);\n\n                        // Show options button on course card.\n                        // check if not mycourse tab.\n                        // This is very bad code, couldn't do it another way.\n                        // it get called each time a single card is added to dom, try to improve it.\n                        // if (!filterobj.tab && !response.latest_card) {\n                        if (!response.latest_card) {\n                            /* eslint promise/always-return: 0 */\n                            $('.course-cards .showoptions').each(function() {\n                                $(this).toolbar({\n                                    content: $(this).data('toolbar'),\n                                    style: 'primary'\n                                });\n                            });\n                        }\n                    }).fail(Notification.exception);\n                }\n\n            } else {\n                var htmldata = '<div class=\"alert alert-warning alert-dismissible  w-full mx-10\" role=\"alert\">';\n                htmldata += '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">' +\n                '<span aria-hidden=\"true\">×</span><span class=\"sr-only\">Close</span></button>' + langstrings[0]+ '</div>';\n                templates.appendNodeContents(cardswrapperarea, htmldata, '');\n\n            }\n\n            // // Pagination html.\n            // // Check if pagination is enabled.\n            if (filterobj.pagination) {\n                cardspagination.empty();\n                templates.appendNodeContents(cardspagination, response.pagination, '');\n            }\n            // $('.courses-tabs .courses-loader-wrap').hide();\n        }).fail(Notification.exception);\n    }\n\n    // This is for, Toolbar redirection not working.\n    $(document).delegate('.tool-item', 'click', function() {\n        window.location = $(this).attr('href');\n    });\n\n    $(categoryfilter).on('change', function(e) {\n        filterobj.category = e.target.value;\n        filterobj.initPagination();\n        window.history.replaceState('pagechange', document.title, M.cfg.wwwroot + '/course/index.php?category=' +\n                    encodeURI(e.target.value));\n        updatePage();\n        populate_tags();\n    });\n\n    // Search Filter.\n    $(searchfilter).on('submit', function(e) {\n        e.preventDefault();\n        filterobj.initPagination();\n        filterobj.search = $('#categoryfilter .simplesearchform .input-group input[type=\"text\"]').val();\n        updatePage();\n    });\n\n    $('#switch-label1, #switch-label2').on('change.bootstrapSwitch', function(e, data){\n        filterobj.tab = e.target.checked;\n        updatePage();\n        populate_tags();\n    });\n\n    // Pagination Click Event.\n    $(document).delegate('.cards-pagination .pagination .page-item .page-link', 'click', function(e) {\n        e.preventDefault();\n        // Update the page number in object for mycourses as well as all courses tab.\n        var linkdata = e.target.href;\n        if (linkdata === undefined) {\n            linkdata = e.target.parentElement.href;\n            if (linkdata === undefined) {\n                linkdata = e.target.parentElement.parentElement.href;\n            }\n        }\n\n        var hashes = linkdata.slice(linkdata.indexOf('?') + 1).split('&');\n        var vars = [],\n        hash;\n        for (var i = 0; i < hashes.length; i++) {\n            hash = hashes[i].split('=');\n            vars.push(hash[0]);\n            vars[hash[0]] = hash[1];\n        }\n\n        if (filterobj.tab) {\n            filterobj.page.mycourses = vars.page;\n        } else {\n            filterobj.page.courses = vars.page;\n        }\n\n        updatePage();\n    });\n\n\n    var init = function(defaultCategory) {\n\n        $(categorylink).on('click', function(event) {\n            event.preventDefault();\n            $(categoryfilter).val($(this).data('id')).trigger('change');\n            return false;\n        });\n        var strings = [\n            {\n                key: 'nocoursefound',\n                component: 'theme_remui'\n            }\n        ];\n        str.get_strings(strings).then(function (stringres) {\n            langstrings = stringres;\n\n            filterobj = categoryFilters(defaultCategory); // Global object for filters.\n            // Initialize global filter object with default values.\n\n            var vars = [],\n            hash;\n            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');\n            for (var i = 0; i < hashes.length; i++) {\n                hash = hashes[i].split('=');\n                vars.push(hash[0]);\n                vars[hash[0]] = hash[1];\n            }\n            \n            if (vars.categoryid && vars.categoryid != 0) {\n                filterobj.category = vars.categoryid;\n            }\n\n            if (vars.categorysort != undefined) {\n                filterobj.sort = vars.categorysort;\n            }\n\n            if (vars.search != undefined) {\n                filterobj.search = vars.search;\n            }\n\n            if (vars.mycourses && vars.mycourses != 0) {\n                filterobj.tab = true;\n                if ($(\"body\").hasClass(\"notloggedin\")) {\n                    filterobj.tab = false;\n                }\n            }\n\n            generateFilters(filterobj); // This will create filters.\n            generateCourseCards(); // Course cards Generation.\n            populate_tags();\n        });\n    }\n\n    return {\n     init: init\n    };\n});\n"],"file":"coursecategorylayout1.min.js"}