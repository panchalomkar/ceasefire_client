"use strict";define(["jquery","core/modal_factory","core/modal_events","core/config","core/ajax","core/notification","core/str"],function(e,t,n,i,s,a,c){var r,o,l=".edw.setupwizard-container",u=l+" .steps-index",d=u+" .step",m=u+" .step.active",p=".edw.setupwizard-container .step-data .adminsettings",v=l+" .next-step",h=l+" .prev-step",_=l+" .continue",y=l+" .license-box",b=y+" .licensing-loader",f=function(e,t){this.totalSteps=e,this.stepStatus=t;for(var n=0;n<t.length;n++)t[n].isactive&&(this.activeStep=n+1),"current"==t[n].status&&(this.currentStep=n+1)};e.extend(f.prototype,{registerEvents:function(){var t=this;e(document).on("click",v,function(){t.activeStep<t.totalSteps&&(t.activeStep==t.currentStep?t.saveCurrentStep(t.activeStep):t.saveCurrentStep(-1),t.activeStep=t.activeStep+1,t.alterStep(t.activeStep),t.updateView(t))}),e(document).on("click",h,function(){t.activeStep>1&&(t.activeStep=t.activeStep-1,t.alterStep(t.activeStep),t.updateView(t))}),e(document).on("click",'.edw.setupwizard-container .license-box .license-btn[name="edd_remui_license_activate"]',function(e){e.preventDefault(),t.serveLicenseData("activate")}),e(document).on("click",'.edw.setupwizard-container .license-box .license-btn[name="edd_remui_license_deactivate"]',function(e){e.preventDefault(),t.serveLicenseData("deactivate")})},saveCurrentStep:function(e){var t=jQuery(".edw.setupwizard-container #adminsettings").serializeArray();s.call([{methodname:"theme_remui_save_current_step",args:{step:e,settings:JSON.stringify(t)}}])[0].done(function(e){}).fail(function(e){e.message.substring(12,e.message.length)})},serveLicenseData:function(t){var n=this;e(b).css("display","inline-block");var i=e('.edw.setupwizard-container .license-box input[name="onLicensePage"]').val(),a=e('.edw.setupwizard-container .license-box input[name="sesskey"]').val(),c=e('.edw.setupwizard-container .license-box input[name="edd_remui_license_key"]').val();c.match(/^([a-z0-9]{32})$/)?s.call([{methodname:"theme_remui_serve_license_data",args:{licensekey:c,sesskey:a,action:t,onlicensepage:i}}])[0].done(function(t){t=JSON.parse(t),e(b).css("display","none"),n.showResponse(t)}).fail(function(t){var i=t.message.substring(12,t.message.length);i=JSON.parse(i),n.showResponse({license:"failed",msg:i.msg,error:!0}),e(b).css("display","none")}):(n.showResponse({license:"failed",msg:o[21],error:!0}),e(b).css("display","none"))},showResponse:function(e){var t={alert:{classes:"alert alert-danger form-group license-alert",icon:"icon fa fa-ban",heading:o[24],text:o[14]},licensekey:{classes:"form-control is-invalid"},status:{color:"red",text:o[5]},buttons:{0:{type:"submit",class:"btn btn-success text-white license-btn",name:"edd_remui_license_activate",value:o[2]}}};0==e.success&&void 0!==e.error&&"expired"===e.error?(t.alert.text=o[19],t.status.text=o[8],t.buttons={0:{type:"submit",class:"btn btn-success text-white license-btn mr-1",name:"edd_remui_license_deactivate",value:o[3]},1:{type:"submit",class:"btn btn-info text-white license-btn",name:"edd_remui_license_renew",value:o[4],onclick:"window.open('https://edwiser.org')"}}):0==e.success&&"invalid"==e.license&&void 0!==e.error&&"disabled"===e.error?(t.alert.text=o[18],t.status.text=o[23],t.buttons={0:{type:"submit",class:"btn btn-success text-white license-btn",name:"edd_remui_license_activate",value:o[2]}}):0==e.success&&"invalid"==e.license&&void 0!==e.error&&"no_activations_left"==e.error?(t.alert.text=o[17],t.status.text=o[11],t.buttons={0:{type:"submit",class:"btn btn-success text-white license-btn",name:"edd_remui_license_activate",value:o[2]}}):0==e.success&&"invalid"==e.license&&void 0!==e.error&&"item_name_mismatch"==e.error?(t.alert.text=o[27],t.status.text=o[26],t.buttons={0:{type:"submit",class:"btn btn-success text-white license-btn",name:"edd_remui_license_activate",value:o[2]}}):"failed"==e.license||"deactivated"==e.license?t={alert:{classes:"alert alert-danger form-group license-alert",icon:"icon fa fa-ban",heading:o[24],text:void 0!==e.msg?e.msg:o[14]},licensekey:{classes:"form-control is-invalid"},status:{color:"red",text:o[5]},buttons:{0:{type:"submit",class:"btn btn-success text-white license-btn",name:"edd_remui_license_activate",value:o[2]}}}:1==e.success&&"valid"==e.license&&e.activations_left>0&&(t={alert:{classes:"alert alert-success form-group license-alert",icon:"icon fa fa-check",heading:o[25],text:o[20]},licensekey:{classes:"form-control is-valid"},status:{color:"green",text:o[6]},buttons:{0:{type:"submit",class:"btn btn-danger text-white license-btn",name:"edd_remui_license_deactivate",value:o[3]}}}),this.updateLicensingView(t)},updateLicensingView:function(e){var t='<div class="'+e.alert.classes+'"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button><h4><i class="'+e.alert.icon+'"></i> <span class="subtext">'+e.alert.heading+'</span></h4> <span class="subtext">'+e.alert.text+"</span></div>";jQuery(y+" .box-container .license-alert").length?jQuery(y+" .box-container .license-alert").replaceWith(t):jQuery(y+" .box-container").prepend(t),jQuery(y+" .box-container .licensekey #edd_remui_license_key").removeClass().addClass(e.licensekey.classes);var n='<div class="col-12 text"><p style="color:'+e.status.color+'">'+e.status.text+"</p></div>";jQuery(y+" .box-container .licensestatus .text").replaceWith(n);var i="";jQuery.each(e.buttons,function(e,t){var n="<input ";jQuery.each(t,function(e,t){n+=e+'="'+t+'" '}),i+=n+=">"}),i+='<div class="licensing-loader spinner-border text-muted hidden"></div>',jQuery(y+" .box-container .licensebuttons .license-form-btn").empty().append(i)},updateView:function(){e(v).prop("disabled",!1),e(h).prop("disabled",!1),e(v).show(),e(_).hide(),this.activeStep==this.totalSteps&&(e(v).hide(),e(_).show()),1==this.activeStep&&(e(h).prop("disabled",!0),e(v).show(),e(_).hide())},alterStep:function(t){e(m).hasClass("current")&&t>this.currentStep&&(e(m).removeClass("current").addClass("done"),e(d+'[data-stepid="'+t+'"]').addClass("current"),e(p+'[data-stepid="'+t+'"]').addClass("current"),this.currentStep=this.currentStep+1),e(m).removeClass("active"),e(".edw.setupwizard-container .step-data .adminsettings.active").removeClass("active"),e(d+'[data-stepid="'+t+'"]').addClass("active"),e(p+'[data-stepid="'+t+'"]').addClass("active"),e("html, body").animate({scrollTop:0},e(window).scrollTop()/6)},requireLangStrings:function(){c.get_strings([{key:"licensenotactive",component:"theme_remui"},{key:"licensenotactiveadmin",component:"theme_remui"},{key:"activatelicense",component:"theme_remui"},{key:"deactivatelicense",component:"theme_remui"},{key:"renewlicense",component:"theme_remui"},{key:"deactivated",component:"theme_remui"},{key:"active",component:"theme_remui"},{key:"notactive",component:"theme_remui"},{key:"expired",component:"theme_remui"},{key:"licensekey",component:"theme_remui"},{key:"licensestatus",component:"theme_remui"},{key:"no_activations_left",component:"theme_remui"},{key:"activationfailed",component:"theme_remui"},{key:"noresponsereceived",component:"theme_remui"},{key:"licensekeydeactivated",component:"theme_remui"},{key:"siteinactive",component:"theme_remui"},{key:"entervalidlicensekey",component:"theme_remui"},{key:"nolicenselimitleft",component:"theme_remui"},{key:"licensekeyisdisabled",component:"theme_remui"},{key:"licensekeyhasexpired",component:"theme_remui"},{key:"licensekeyactivated",component:"theme_remui"},{key:"entervalidlicensekey",component:"theme_remui"},{key:"edwiserremuilicenseactivation",component:"theme_remui"},{key:"disabled",component:"theme_remui"},{key:"alert",component:"theme_remui"},{key:"success",component:"theme_remui"},{key:"invalid",component:"theme_remui"},{key:"purchasecodeinvalid",component:"theme_remui"}]).then(function(e){o=e})}});return{init:function(t){t=JSON.parse(t.replace(/&quot;/g,'"')),(r=new f(e(".stepscount").val(),t)).registerEvents(),r.updateView(),r.requireLangStrings()},skipUpgrade:function(){var e="#page-admin-upgradesettings #admin-enableannouncement";jQuery(e).parent().prev().hide(),jQuery(e).parent().hide()},prompt:function(){c.get_strings([{key:"setupwizard",component:"theme_remui"},{key:"setupwizardmodalmsg",component:"theme_remui"}]).then(function(c){t.create({type:t.types.SAVE_CANCEL,title:c[0],body:c[1]}).then(function(t){t.setSaveButtonText(c[0]);var r=t.getRoot();r.on(n.save,function(){s.call([{methodname:"theme_remui_set_setting",args:{configname:"flagsetupwizard",configvalue:!0},done:function(){e(location).attr("href",i.wwwroot+"/theme/remui/setupwizard.php")},fail:a.exception}])}),r.on(n.cancel,function(){s.call([{methodname:"theme_remui_set_setting",args:{configname:"flagsetupwizard",configvalue:!0},done:function(){},fail:a.exception}])}),t.show()})})}}});
//# sourceMappingURL=setupwizard.min.js.map
