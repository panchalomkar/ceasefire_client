"use strict";define(["jquery","theme_remui/bootstrap-select","core/templates","theme_remui/jquery-toolbar","core/ajax","core/str","core/notification"],function(e,t,a,s,i,r,o){var n,c,l=e("select#sortfilter.selectpicker"),d=e(".category-filters .simplesearchform .simplesearchform"),u=e("select#categoryfilter.selectpicker"),p=e("#coursestab"),g=e("#mycoursestab"),f=e("#coursesregion div.content"),h=e("#mycoursesregion div.content"),m=e("#coursespagination"),v=e("#mycoursespagination"),y=e(".togglebtn"),b="theme_remui/course_card_grid",w="theme_remui/course_card_list",_=".page-header-actionss",C=new function(){this.mycourses=!1,this.courses=!1,this.isLoaded=function(){return this[C.getActive()]},this.loaded=function(e){void 0===e&&(e=!0),this[C.getActive()]=e},this.reset=function(){this.mycourses=!1,this.courses=!1},this.getActive=function(){return!0===n.tab?"mycourses":"courses"}};function k(){e(".courses-tabs .courses-loader-wrap").show();var t=n.tab?h:f,s=n.tab?v:m;i.call([{methodname:"theme_remui_get_courses",args:{data:JSON.stringify(n)}}])[0].done(function(i){i=JSON.parse(i),e(_).empty(),1==i.hasmanagebutton&&e(_).append(i.managebuttons),null!=i.dropdown?e("#page-header .page-header-actionss").append(i.dropdown):e('#page-header .page-header-actionss [data-enhance="moodle-core-actionmenu"]').remove();var r=null===n.view?i.view:n.view,l="grid"==r||i.latest_card?b:w;(window.screen.width<=480||i.latest_card)&&(l=b,r="grid"),"grid"==r?(n.view="grid",e(".tab-content").addClass("grid-view").removeClass("list-view"),e(".grid_btn").addClass("btn-primary active"),e(".list_btn").removeClass("btn-primary active")):(n.view="list",e(".tab-content").addClass("list-view").removeClass("grid-view"),e(".grid_btn").removeClass("btn-primary active"),e(".list_btn").addClass("btn-primary active")),i.latest_card?(e(".tab-content").addClass("latest-cards"),e(".viewtoggler").addClass("hidden")):(e(".tab-content").removeClass("latest-cards"),e(".viewtoggler").removeClass("hidden"));var d=i.courses;if(d.length>0)for(var u=0;u<d.length;u++)a.render(l,d[u]).then(function(s,r){a.appendNodeContents(t,s,r),n.tab||i.latest_card||e(".showoptions").each(function(){e(this).toolbar({content:e(this).data("toolbar"),style:"primary"})})}).fail(o.exception);else{var p='<div class="alert alert-warning alert-dismissible  w-full mx-10" role="alert">';p+='<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">Ã—</span><span class="sr-only">Close</span></button>'+c[0]+"</div>",a.appendNodeContents(t,p,"")}n.pagination&&a.appendNodeContents(s,i.pagination,""),e(".courses-tabs .courses-loader-wrap").hide()}).fail(o.exception)}function x(){C.isLoaded()||(n.isFilterModified=!0,function(){var t=n.tab?h:f;if(e(t).empty(),n.pagination){var a=n.tab?v:m;e(a).empty()}}(),k(),n.isFilterModified=!1,C.loaded())}e(document).ready(function(){r.get_strings([{key:"nocoursefound",component:"theme_remui"}]).then(function(t){var a,s;c=t,(s={category:"all",sort:null,search:"",tab:!1,page:a={courses:0,mycourses:0},pagination:!0,view:null,isFilterModified:!0}).initAttributes=function(){s.category="all",s.sort=null,s.search="",s.tab=!1,s.page=a,s.pagination=!0,s.view=null,s.isFilterModified=!0},s.initPagination=function(){s.page={courses:0,mycourses:0}},n=s;for(var i,r=[],o=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),l=0;l<o.length;l++)i=o[l].split("="),r.push(i[0]),r[i[0]]=i[1];r.categoryid&&0!=r.categoryid&&(n.category=r.categoryid),null!=r.categorysort&&(n.sort=r.categorysort),null!=r.search&&(n.search=r.search),r.mycourses&&0!=r.mycourses&&(n.tab=!0,e("body").hasClass("notloggedin")&&(n.tab=!1)),function(t){e(".selectpicker").each(function(){e(this).selectpicker()}),"0"!==t.category&&e("#categoryfilter.selectpicker").selectpicker("val",t.category);null!==t.sort&&e("#sortfilter.selectpicker").selectpicker("val",t.sort);""!==t.sort&&e("#coursesearchbox").val(t.search);e(".category-filters").removeClass("d-none")}(n),k(),C.loaded()}).fail(o.exception)}),e(document).delegate(".tool-item","click",function(){window.location=e(this).attr("href")}),e(u).on("changed.bs.select",function(e){n.category=e.target.value,n.initPagination(),C.reset(),x()}),e(l).on("changed.bs.select",function(e){n.sort=e.target.value,C.reset(),x()}),e(p).on("click",function(){n.tab=!1,x()}),e(g).on("click",function(){n.tab=!0,x()}),e(d).on("submit",function(t){t.preventDefault(),n.initPagination(),n.search=e('.category-filters .simplesearchform .input-group input[type="text"]').val(),C.reset(),x()}),e(y).on("click",function(){var t=e(this).attr("data-view");n.view=t,M.util.set_user_preference("course_view_state",t,null),C.reset(),x()}),e(y).keypress(function(t){if(32==t.keyCode||13==t.keyCode)try{t.preventDefault();var a=e(this).attr("data-view");n.view=a,M.util.set_user_preference("course_view_state",a,null),C.reset(),x()}catch(t){console.log(t)}}),e(document).delegate(".tab-pane .pagination .page-item .page-link","click",function(e){e.preventDefault();var t=e.target.href;void 0===t&&void 0===(t=e.target.parentElement.href)&&(t=e.target.parentElement.parentElement.href);for(var a,s=t.slice(t.indexOf("?")+1).split("&"),i=[],r=0;r<s.length;r++)a=s[r].split("="),i.push(a[0]),i[a[0]]=a[1];n.tab?n.page.mycourses=i.page:n.page.courses=i.page,C.loaded(!1),x()})});
//# sourceMappingURL=coursecategory.min.js.map
