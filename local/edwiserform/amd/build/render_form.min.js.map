{"version":3,"sources":["render_form.js"],"names":["define","$","Ajax","Notification","formStyles","SELECTORS","CONTAINER","FULLPAGE","UPLOADED_FILE","DELETE_FILE","DELETE_CANCEL","FILE","COMPONENT","ATTRIBUTE","DATA_DELETING","DATA_PROCESSING","formeoOpts","container","countries","localStorage","formeo","forms","fullpage","val","PROMISES","GET_FORM_DEFINITION","id","call","methodname","args","form_id","window","SUBMIT_FORM_DATA","formid","formdata","data","UPLOAD_FILE","file","FormData","append","M","cfg","sesskey","ajax","url","wwwroot","type","cache","async","dataType","processData","contentType","upload_form_data","form","submitButton","label","processingLabel","afterSubmit","arguments","length","undefined","text","done","response","status","JSON","parse","action","location","href","msg","dom","alert","html","trigger","cmid","hasOwnProperty","errors","remove","each","name","error","errorview","find","after","display_validation_errors","loadingClose","fail","ex","submit_form","_this","event","closest","valid","checkValidity","attr","parent","submit","preventDefault","loading","setTimeout","serializeArray","removeList","filteredList","forEach","element","index","indexOf","push","stringify","filter_formdata","fileinputs","fileinput","files","value","itemid","console","log","delete","upload_files","render_forms","sitekey","Formeo","definition","render","prepend","title","formData","i","elem","tagName","prop","changeEvent","CustomEvent","target","dispatchEvent","util","get_string","filename","is","parents","addClass","load_form_data","apply","style","apply_action","this","click","exception","init","document","ready","e","resize","manageFormWidth","on","siblings","next","hasClass","inArray","multiActions","open"],"mappings":"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","sourcesContent":["/*\n * Edwiser_Forms - https://edwiser.org/\n * Version: 0.1.0\n * Author: Yogesh Shirsath\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'local_edwiserform/form_styles',\n    'local_edwiserform/iefixes',\n    'local_edwiserform/formviewer'\n], function ($, Ajax, Notification, formStyles) {\n    var SELECTORS = {\n        CONTAINER: '.edwiserform-container',\n        FULLPAGE: '#edwiserform-fullpage',\n        UPLOADED_FILE: 'efb-uploaded-file',\n        DELETE_FILE: 'efb-delete-user-file',\n        DELETE_CANCEL: 'efb-delete-user-file-cancel',\n        FILE: 'input[type=\"file\"]',\n        COMPONENT: 'local_edwiserform'\n    };\n\n    var ATTRIBUTE = {\n        DATA_DELETING: 'data-deleting',\n        DATA_PROCESSING: 'data-processing'\n    };\n\n    let formeoOpts = {\n        container: '',\n        countries: typeof countries == 'undefined' ? null : countries,\n        localStorage: false, // Changed from session storage to local storage.\n    };\n\n    var formeo = [];\n    var forms = $(SELECTORS.CONTAINER);\n    var fullpage = $(SELECTORS.FULLPAGE) && $(SELECTORS.FULLPAGE).val();\n\n    var PROMISES = {\n        /**\n         * Call moodle service edwiser_get_form_definition\n         * @param  {Number}  id Form id\n         * @return {Promise}    Ajax promise call\n         */\n        GET_FORM_DEFINITION: function(id) {\n            var promise = Ajax.call([{\n                methodname: 'edwiserform_get_form_definition',\n                args: {\n                    form_id: id,\n                    countries: typeof window['countries'] == 'undefined' || true\n                }   \n            }]);\n            return promise[0];\n        },\n        /**\n         * Call moodle service edwiser_submit_form_data\n         * @param  {Number}  formid   Form id\n         * @param  {String}  formdata Submitted form data\n         * @return {Promise}    Ajax promise call\n         */\n        SUBMIT_FORM_DATA: function(formid, formdata) {\n            var promise = Ajax.call([{\n                methodname: 'edwiserform_submit_form_data',\n                args: {\n                    formid: formid,\n                    data: formdata\n                }\n            }]);\n            return promise[0];\n        },\n        /**\n         * Call moodle service edwiser_submit_form_data\n         * @param  {Number}  formid   Form id\n         * @param  {String}  formdata Submitted form data\n         * @return {Promise}    Ajax promise call\n         */\n        UPLOAD_FILE: function(file) {\n            var data = new FormData();\n            data.append('sesskey', M.cfg.sesskey);\n            data.append(0, file);\n            return $.ajax({\n                url: M.cfg.wwwroot + '/local/edwiserform/upload.php',\n                type: 'POST',\n                data: data,\n                cache: false,\n                async: false,\n                dataType: 'json',\n                processData: false, // Don't process the files.\n                contentType: false // Set content type to false as jQuery will tell the server its a query string request.\n            });\n        }\n    }\n\n    /**\n     * Apply action to form container\n     * @param  {DOM}    form   Form DOM element\n     * @param  {STRING} action Action link\n     */\n    function apply_action(form, action) {\n        $(form).attr('action', action);\n    }\n\n    /**\n     * Load data to form fields and trigger events\n     * @param  {DOM} form DOM form object\n     * @param  {Object} data Previously + Default data of user\n     */\n    function load_form_data(form, data) {\n        var formData = JSON.parse(data);\n        $.each(formData, function(index, attr) {\n            $.each($(form).find('[name=\"' + attr.name + '\"]'), function(i, elem) {\n                switch (elem.tagName) {\n                    case 'INPUT':\n                        switch (elem.type) {\n                            case 'radio':\n                                if (elem.value == attr.value) {\n                                    $(elem).prop('checked', true);\n                                }\n                                var changeEvent = new CustomEvent(\"click\", {target: $(elem)[0]});\n                                $(elem)[0].dispatchEvent(changeEvent);\n                                break;\n                            case 'checkbox':\n                                if (elem.value == attr.value) {\n                                    $(elem).prop('checked', true);\n                                }\n                                break;\n                            case 'file':\n                                if (attr.value != 0) {\n                                    $(elem).after('<span class=\"efb-delete-user-file-notice\">' + M.util.get_string('delete-userfile-on-save-notice', SELECTORS.COMPONENT) + '</span>');\n                                    $(elem).after('<a href=\"#\" class=\"' + SELECTORS.DELETE_CANCEL + '\">' + M.util.get_string('cancel-delete-userfile', SELECTORS.COMPONENT) + '</a>');\n                                    $(elem).after('<a href=\"#\"  class=\"' + SELECTORS.DELETE_FILE + '\">' + M.util.get_string('efb-form-action-delete-title', SELECTORS.COMPONENT) + '</a>');\n                                    $(elem).after('<a class=\"' + SELECTORS.UPLOADED_FILE + '\" target=\"_blank\" href=\"' + attr.value + '\">' + attr.filename + '</a>');\n                                }\n                                break;\n                            default:\n                                $(elem).val(attr.value);\n                                break;\n                        }\n                        break;\n                    case 'SELECT':\n                        if ($(elem).is('[multiple=\"true\"]')) {\n                            let value = $(elem).val();\n                            value.push(attr.value);\n                            attr.value = value;\n                        }\n                    case 'TEXTAREA':\n                        $(elem).val(attr.value);\n                        break;\n                }\n                var changeEvent = new CustomEvent(\"change\", {target: $(elem)[0]});\n                $(elem)[0].dispatchEvent(changeEvent);\n                if ($(elem).val() != '') {\n                    $(elem).parents('.f-field-group').addClass('active');\n                }\n            });\n        });\n    }\n\n    /**\n     * Display validation errors to form element\n     * @param {DOM}   form Form DOM element object\n     * @param {Array}      errors errors list\n     */\n    function display_validation_errors(form, errors) {\n        var errors = JSON.parse(errors);\n        $('.custom-validation-error').remove();\n        $.each(errors, function(name, error) {\n            var errorview = $(form).find('#' + name + '-error');\n            if (errorview.length == 0) {\n                $(form).find('[name=\"' + name + '\"]').after('<span id=\"' + name + '-error\" class=\"text-error custom-validation-error\"></span>');\n                errorview = $(form).find(\"#\" + name + \"-error\");\n            }\n            errorview.text(error);\n        });\n    }\n\n    /**\n     * Upload form data to service\n     * @param {DOM}      form            Form DOM element object\n     * @param {Formeo}   formeo          Formeo object\n     * @param {DOM}      submitButton    Submit button DOM object\n     * @param {String}   label           Label for submit button\n     * @param {String}   processingLabel Label for submit button when form data is being submit\n     * @param {Number}   formid          Form id\n     * @param {String}   formdata        Submitted form data\n     * @param {Function} afterSubmit     Function to be called after form submission\n     */\n    function upload_form_data(form, formeo, submitButton, label, processingLabel, formid, formdata, afterSubmit = null) {\n        $(submitButton).text(processingLabel);\n        PROMISES.SUBMIT_FORM_DATA(formid, formdata)\n        .done(function(response) {\n            if (response.status) {\n                if (typeof response.data != 'undefined' && response.data != '') {\n                    data = JSON.parse(response.data);\n                    if (data.action == 'redirect') {\n                        window.location.href = data.url;\n                        return;\n                    } else if (data.action == 'confirmredirect') {\n                        if (response.msg != '') {\n                            formeo.dom.alert('warning', response.msg, function() {\n                                window.location.href = data.url;\n                            });\n                        } else {\n                            window.location.href = data.url;\n                        }\n                        return;\n                    }\n                }\n                $(form).html(response.msg);\n                formeo.dom.alert('success', response.msg);\n                if (afterSubmit != null) {\n                    afterSubmit(form, formdata);\n                }\n                if ($('#edwiser-activity') && $('#edwiser-activity').val() == true) {\n                    $('body').trigger({\n                        type: 'formSubmitted',\n                        cmid: $('#cmid').val()\n                    });\n                }\n            } else {\n                if (response.msg != '') {\n                    formeo.dom.alert('warning', response.msg);\n                }\n                if (response.hasOwnProperty('errors')) {\n                    display_validation_errors(form, response.errors);\n                }\n            }\n            formeo.dom.loadingClose();\n            $(submitButton).text(label);\n        }).fail(function(ex) {\n            $(submitButton).text(label);\n            formeo.dom.loadingClose();\n            $(submitButton).text(label);\n        });\n    }\n\n    /**\n     * Filter form data\n     * @param  {Array} formdata Submitted form data array\n     * @return {String}           JSON formdata\n     */\n    function filter_formdata(formdata) {\n        var removeList = ['g-recaptcha-response'];\n        var filteredList = [];\n        formdata.forEach(function(element, index) {\n            if (removeList.indexOf(element.name) == -1) {\n                filteredList.push(element);\n            }\n        });\n        return JSON.stringify(filteredList);\n    }\n\n    /**\n     * Upload file to server\n     * @param  {DOM}   form     Form DOM element object\n     * @param  {Array} formdata Form data\n     * @return {Array}          Form data\n     */\n    function upload_files(form, formdata) {\n        var fileinputs = $(form).find(SELECTORS.FILE);\n        $.each(fileinputs, function(index, fileinput) {\n            if (fileinput.files.length != 0) {\n                PROMISES.UPLOAD_FILE(fileinput.files[0])\n                .done(function(response) {\n                    if (response.status == true) {\n                        formdata.push({\n                            name: $(fileinput).attr('name'),\n                            type: 'file',\n                            value: response.itemid\n                        });\n                    }\n                })\n                .fail(function(ex) {\n                    console.log(ex);\n                });\n            } else if ($(fileinput).attr(ATTRIBUTE.DATA_DELETING) == \"true\") {\n                formdata.push({\n                    name: $(fileinput).attr('name'),\n                    type: 'file',\n                    value: 0,\n                    delete: true\n                });\n            } else {\n                formdata.push({\n                    name: $(fileinput).attr('name'),\n                    type: 'file',\n                    value: 0\n                });\n            }\n        });\n        return formdata;\n    }\n\n    /**\n     * Prepare and submit form data to server\n     * @param  {DOM}    _this  Clicked form object\n     * @param  {Formeo} formeo Formeo object\n     * @param  {Event}  event  Event triggered on form\n     * @return {Boolen}        True if form submit is allowed\n     */\n    function submit_form(_this, formeo, event) {\n        var form = $(_this).closest('form');\n        var submitButton = _this;\n        var valid = formeo.dom.checkValidity(form[0]);\n        var label = $(_this).text();\n        var processingLabel = $(_this).attr(ATTRIBUTE.DATA_PROCESSING);\n        var formid = $(form).parent().find('.id').val();\n        if (valid) {\n            if ($(form).attr('action') != '') {\n                $(form).submit();\n                return true;\n            }\n            event.preventDefault();\n            formeo.dom.loading();\n            setTimeout(function() {\n                var formdata = form.serializeArray();\n                formdata = upload_files(form, formdata);\n                formdata = filter_formdata(formdata);\n                upload_form_data(form, formeo, submitButton, label, processingLabel, formid, formdata);\n            }, 1000);\n        }\n        return false;\n    }\n\n    /**\n     * Initialize events on elements\n     */\n    function initializeEvents() {\n        // Handle form field arrangement on resize.\n        $(window).resize(function() {\n            $.each(forms, function(index) {\n                if (typeof formeo[index] != 'undefined') {\n                    formeo[index].dom.manageFormWidth(fullpage);\n                }\n            });\n        });\n\n        $('.step-navigation #previous-step, .step-navigation #next-step').click(function() {\n            return;\n        });\n\n        $('body').on('click', '.' + SELECTORS.DELETE_FILE, function(event) {\n            event.preventDefault();\n            $(this).siblings(SELECTORS.FILE).attr(ATTRIBUTE.DATA_DELETING, true);\n        }).on('click', '.' + SELECTORS.DELETE_CANCEL, function(event) {\n            event.preventDefault();\n            $(this).siblings(SELECTORS.FILE).attr(ATTRIBUTE.DATA_DELETING, false);\n        }).on('change', SELECTORS.FILE, function() {\n            // Add file.\n            let _this = this;\n            if ($(this)[0].files.length == 0) {\n                return;\n            }\n            if ($(this).next().hasClass(SELECTORS.UPLOADED_FILE)) {\n                let index = $.inArray($(_this).parents(SELECTORS.CONTAINER)[0], $(SELECTORS.CONTAINER));\n                formeo[index].dom.multiActions(\n                    'warning',\n                    M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n                    M.util.get_string(\"user-file-replace\", SELECTORS.COMPONENT, $(this).find('h4').text()),\n                    [{\n                        title: M.util.get_string('proceed', SELECTORS.COMPONENT),\n                        type: 'warning'\n                    }, {\n                        title: M.util.get_string('cancel', SELECTORS.COMPONENT),\n                        type: 'primary',\n                        action: function() {\n                            $(_this).val('');\n                        }\n                    }]\n                );\n            }\n        }).on('click', '.efb-view-fullpage', function() {\n            // View form on full page.\n            var id = $(this).closest(SELECTORS.CONTAINER).parent().find('input[class=\"id\"]').val();\n            window.open(M.cfg.wwwroot + '/local/edwiserform/form.php?id=' + id);\n            $(this).closest(SELECTORS.CONTAINER).html(M.util.get_string('fullpage-link-clicked', SELECTORS.COMPONENT));\n        });\n    }\n\n    /**\n     * Render all forms on the page\n     * @param  {String} sitekey sitekey for Google recaptcha\n     */\n    function render_forms(sitekey) {\n        formeoOpts.sitekey = sitekey;\n        $.each(forms, function(index, form) {\n            var idElement = $(form).parent().find('.id');\n            var id = idElement.val();\n            PROMISES.GET_FORM_DEFINITION(id)\n            .done(function(response) {\n                if (response.status != false) {\n                    if ((typeof window['countries'] == 'undefined' ||window['countries'] == false) &&\n                        (typeof response.countries != 'undefined' && response.countries != false)) {\n                        window['countries'] = JSON.parse(response.countries)\n                        formeoOpts.countries = countries;\n                    }\n                    formeoOpts.container = form;\n                    formeo[index] = new Formeo(formeoOpts, response.definition);\n                    formeo[index].render(form);\n                    $(form).prepend(\"<h2 class='form-header'>\" + response.title + \"</h2>\");\n                    if (response.data) {\n                        load_form_data(form, response.data);\n                    }\n                    formStyles.apply($(form).find('.formeo-render'), 'add', response.style);\n                    if (response.action && response.action != '') {\n                        apply_action(form, response.action);\n                    }\n                    $(form).submit(function(event) {\n                        return submit_form(this, formeo[index], event);\n                    })\n                    .find('#submit-form').click(function() {\n                        return submit_form(this, formeo[index], event);\n                    });\n                } else {\n                    $(form).html(response.msg).addClass(\"empty\");\n                }\n            }).fail(Notification.exception);\n        });\n    }\n    return {\n        init: function(sitekey) {\n            $(document).ready(function (e) {\n                if ($('#edwiserform-fullpage').length != 0 && $('#edwiserform-fullpage').val() == true) {\n                    $('body').addClass('edwiserform-fullpage');\n                }\n                render_forms(sitekey);\n                initializeEvents();\n            });\n        }\n    };\n});\n"],"file":"render_form.min.js"}