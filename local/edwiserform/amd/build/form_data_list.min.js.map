{"version":3,"sources":["form_data_list.js"],"names":["define","$","Ajax","Notification","Templates","update_separator","length","each","index","tr","find","remove","actions","slice","after","init","formid","allowed","table","PROMISES","DELETE_SUBMISSION","ids","call","methodname","args","id","submissions","GET_FORM_SUBMISSIONS","search","start","delete_submissions","Formeo","dom","multiActions","M","util","get_string","title","type","action","loading","done","response","status","alert","msg","draw","prop","loadingClose","fail","ex","exception","fn","dataTable","ext","errMode","document","ready","e","addClass","DataTable","paging","ordering","bProcessing","bServerSide","rowId","bDeferRender","scrollY","scrollX","scrollCollapse","classes","sScrollHeadInner","language","sSearch","emptyTable","info","end","total","infoEmpty","buttons","ajax","data","callback","settings","value","errors","list","i","append","get","show_errors","drawCallback","removeClass","render","wwwroot","cfg","license","html","js","replaceNode","setTimeout","element","element2","css","window","getComputedStyle","width","FixedColumns","iLeftColumns","on","open","location","href","this","is","val","toaster","push","event","preventDefault"],"mappings":"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","sourcesContent":["/*\n * To change this license header, choose License Headers in Project Properties.\n * To change this template file, choose Tools | Templates\n * and open the template in the editor.\n */\n\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/templates',\n    'local_edwiserform/jquery.dataTables',\n    'local_edwiserform/dataTables.bootstrap4',\n    'local_edwiserform/buttons.bootstrap4',\n    'local_edwiserform/fixedColumns.bootstrap4',\n    'local_edwiserform/formviewer'\n], function ($, Ajax, Notification, Templates) {\n    var update_separator = function() {\n        var actions = null;\n        if ($('.DTFC_LeftBodyLiner tr').length == 0) {\n            return;\n        }\n        $('.DTFC_LeftBodyLiner tr').each(function(index, tr) {\n            $(tr).find('.efb-data-actions span').remove();\n            var actions = $(tr).find('.efb-data-action.show');\n            if (actions.length < 2) {\n                return;\n            }\n            actions.slice(0, actions.length - 1).after('<span> | </span>');\n        });\n    };\n\n    /**\n     * Show errors as a list in modal\n     * @param {Array} errors Errors string list\n     */\n    var show_errors = function(errors) {\n        var list = $('<ul></ul>');\n        for (var i = 0; i < errors.length; i++) {\n            list.append($('<li>' + errors[i] + '</li>'));\n        }\n        Formeo.dom.alert(\n            'warning',\n            list.get(0)\n        );\n    };\n    return {\n        update_separator: update_separator,\n        init: function(formid, allowed) {\n            var table;\n            var PROMISES = {\n                /**\n                 * Ajax promise to delete form submission by ids\n                 * @param  {Array}   ids Ids array of submission\n                 * @return {Promise}     Ajax promise\n                 */\n                DELETE_SUBMISSION: function(ids) {\n                    return Ajax.call([{\n                        methodname: 'edwiserform_delete_submissions',\n                        args: {\n                            id: formid,\n                            submissions: ids\n                        }\n                    }])[0]\n                },\n\n                /**\n                 * Get form data using ajax\n                 * @param  {String}  search Search query\n                 * @param  {Number}  length Number of courses\n                 * @param  {Number}  start  Start index of courses\n                 * @return {Promise}        Ajax promise\n                 */\n                GET_FORM_SUBMISSIONS: function(search, start, length) {\n                    return Ajax.call([{\n                        methodname: 'edwiserform_get_form_submissions',\n                        args: {\n                            formid : formid,\n                            search : search,\n                            start  : start,\n                            length : length\n                        }\n                    }])[0];\n                },\n            };\n\n            $.fn.dataTable.ext.errMode = 'none';\n\n            $(document).ready(function (e) {\n                if (!allowed) {\n                    $('body').addClass('user-view');\n                }\n                table = $(\"#efb-form-submissions\").DataTable({\n                    paging          : true,\n                    ordering        : false,\n                    bProcessing     : true,\n                    bServerSide     : true,\n                    rowId           : 'DT_RowId',\n                    bDeferRender    : true,\n                    scrollY         : \"400px\",\n                    scrollX         : true,\n                    scrollCollapse  : true,\n                    classes: {\n                        sScrollHeadInner: 'efb_dataTables_scrollHeadInner'\n                    },\n                    dom             : '<\"efb-top\"<\"efb-listing\"l><\"efb-list-filtering\"f>>t<\"efb-bottom\"<\"efb-list-pagination\"p><B>' + (allowed ? '<\"efb-bulk\">' : '') + '>i',\n                    language        : {\n                        sSearch: M.util.get_string('efb-search-form', 'local_edwiserform'),\n                        emptyTable: M.util.get_string('listformdata-empty', 'local_edwiserform'),\n                        info: M.util.get_string('efb-heading-listforms-showing', 'local_edwiserform', {'start': '_START_', 'end': '_END_', 'total': '_TOTAL_'}),\n                        infoEmpty: M.util.get_string('efb-heading-listforms-showing', 'local_edwiserform', {'start': '0', 'end': '0', 'total': '0'}),\n                    },\n                    buttons         : [],\n                    ajax: function(data, callback, settings) {\n                        PROMISES.GET_FORM_SUBMISSIONS(\n                            data.search.value,\n                            data.start,\n                            data.length\n                        ).done(function(response) {\n                            if (response.errors.length != 0) {\n                                show_errors(response.errors);\n                            }\n                            delete response.errors;\n                            callback(response);\n                            update_separator();\n                        }).fail(Notification.exception);\n                    },\n                    drawCallback    : function( settings ) {\n                        update_separator();\n                        if (allowed) {\n                            $('.efb-bottom .dt-buttons').removeClass('btn-group');\n                            Templates.render('local_edwiserform/bulk-actions', {\n                                formid: formid,\n                                wwwroot: M.cfg.wwwroot,\n                                license: license == 'available' ? '' : M.util.get_string('activate-license', 'local_edwiserform')\n                            }, 'theme_remui')\n                            .done(function(html, js) {\n                                Templates.replaceNode($('.efb-bulk'), html, js);\n                            })\n                            .fail(Notification.exception);\n                        }\n                        setTimeout(function() {\n                            var element = $('.DTFC_LeftHeadWrapper .efb-table tr th:first-child');\n                            var element2 = $('.DTFC_LeftBodyLiner .efb-table tr td:first-child');\n                            $(element2).css('width', window.getComputedStyle(element[0]).width);\n                        }, 0);\n                    }\n                });\n                new $.fn.dataTable.FixedColumns(table, {\n                    iLeftColumns: 2\n                });\n            });\n\n            /**\n             * Delete submission from ids passed in parameter\n             * @param  {Array} ids Ids array of submissions\n             */\n            function delete_submissions(ids) {\n                Formeo.dom.multiActions(\n                    'warning',\n                    M.util.get_string('deletesubmission', 'local_edwiserform'),\n                    M.util.get_string('deletesubmissionmsg', 'local_edwiserform'),\n                    [{\n                        title: M.util.get_string('proceed', 'local_edwiserform'),\n                        type: 'danger',\n                        action: function() {\n                            Formeo.dom.loading();\n                            PROMISES.DELETE_SUBMISSION(ids).done(function(response) {\n                                if (response.status == true) {\n                                    Formeo.dom.alert('success', '<div class=\"col-12\">' + response.msg + '</div>');\n                                    table.draw();\n                                    $('.submission-check-all').prop('checked', false);\n                                }\n                                Formeo.dom.loadingClose();\n                            }).fail(function(ex) {\n                                Notification.exception(ex);\n                                Formeo.dom.loadingClose();\n                            });\n                        }\n                    }, {\n                        title: M.util.get_string('cancel', 'local_edwiserform'),\n                        type: 'success'\n                    }]\n                );\n            }\n\n            $('body').on('click', '.efb-csv-export', function() {\n                if (license != 'available') {\n                    window.location.href = M.cfg.wwwroot + '/admin/settings.php?section=local_edwiserform&activetab=local_edwiserform_license_status';\n                    return;\n                }\n                window.open(M.cfg.wwwroot + \"/local/edwiserform/export.php?id=\" + formid + \"&action=data\");\n            });\n\n            // Select All/None checkbox.\n            $('body').on('change', '.submission-check-all', function() {\n                $('.DTFC_Cloned .submission-check').prop('checked', $(this).is(':checked'));\n            });\n\n            // Apply bulk actions.\n            $('body').on('click', '#efb-apply-actions', function() {\n                switch($('#efb-bulk-actions').val()) {\n                    case 'bulkaction':\n                        // Show toaster if bulk action is not selected.\n                        Formeo.dom.toaster(M.util.get_string('selectbulkaction', 'local_edwiserform'));\n                        break;\n                    case 'delete':\n                        // Show toaster if deletiong submission without selecting any.\n                        if (!$('.submission-check').is(':checked')) {\n                            Formeo.dom.toaster(M.util.get_string('emptysubmission', 'local_edwiserform'));\n                            return;\n                        }\n\n                        var ids = [];\n                        // Prepare ids array to delete.\n                        $('.submission-check:checked').each(function(i, e) {\n                            ids.push($(e).data('value'));\n                        });\n                        delete_submissions(ids);\n                        break;\n                }\n            });\n\n            $('body').on('click', '.efb-data-action.delete-action', function() {\n                delete_submissions([$(this).data('value')]);\n            });\n\n            $('body').on('click', '.efb-data-action', function(event) {\n                event.preventDefault();\n                return;\n            });\n        }\n    };\n});\n"],"file":"form_data_list.min.js"}