{"version":3,"sources":["new_form_main.js"],"names":["define","$","ajax","Templates","formStyles","formeo","SELECTORS","FORMTYPE","COMPONENT","EVENT","EVENT_LIST","FORM_STYLE","RENDER_FORM","PANEL","TEMPLATE_OVERLAY","TITLE","ACTIVE","FORM_TITLE","TEMPLATES_ROOT","CONSTANTS","container","document","querySelector","renderContainer","saved","fastselect","formeoOpts","countries","license","svgSprite","M","cfg","wwwroot","localStorage","eventsLoaded","createEvent","initEvent","window","eventlist","PROMISES","GET_TEMPLATE","type","call","methodname","args","name","GET_EVENT_SETTINGS","event","id","CREATE_NEW_FORM","settings","formdef","setting","toString","UPDATE_FORM","TEMPLATES","SETTINGS_CONTAINER","obj","render","resetForm","dom","loading","formtype","val","done","response","loadingClose","status","Formeo","definition","forEach","hasOwnProperty","has_required_fields","add_event_required_fields","fail","ex","alert","message","resetable","fastselect_custom_callbacks","removeSelectedOption","option","$choiceItem","value","removedModel","this","optionsCollection","removeSelected","$item","removeClass","options","itemSelectedClass","remove","$el","find","selectorFromClass","choiceItemClass","updateDomElements","writeToInput","toaster","util","get_string","html","setSelectedOption","isSelected","setSelected","selectedModel","findWhere","model","isMultiple","$controls","addChoiceItem","fastsearch","$resultItems","$toggleBtn","text","addClass","pluginhassetting","plugin","get_event_settings","js","appendNodeContents","init","location","reload","empty_form_definition","JSON","parse","get_form_def","Object","keys","fields","length","can_see_preview","emptyform","toggleClass","formData","can_save_form","check_template","check_title","parents","promise","console","log","switch_panel","showError","undefined","get_form_settings","active","attr","emptytitle","title","get_date","is","datetime","Date","getTime","getEventsSettings","arguments","selectedevents","data","description","events","join","enable_notifi_email","prop","notifi_email","notifi_email_subject","notifi_email_body","emailbodydraftitemid","confirmation_subject","confirmation_message","msgdraftitemid","data_edit","style","selectedStyle","allowsubmissionsfromdate","allowsubmissionstodate","eventsettings","get_settings","stringify","save_form_settings","action","callable","select_template","template","changeEvent","CustomEvent","target","dispatchEvent","push","destroy","initializeTemplate","trigger","show_target_warning","multiActions","href","change_heading","formName","show","hide","substr","closest","append","empty","label","parent","detach","prependTo","callbacks","replace_template","msg","field","attrs","required","hasFieldWithName","addMissingField","form_create_action","onbeforeunload","formname","mod_edwiserform_return","opener","local_edwiserform_add_new_form","reset","setTimeout","form_update_action","local_edwiserform_edit_form","forceupdate","initializeEvents","click","mouseenter","css","offset","top","mouseleave","i","supportedStyles","hasClass","apply","on","toggleImportButton","preventDefault","eleCont","collapseOnly","next","_this","each","node","height","clientHeight","addEventListener","once","toggleEventSettings","temp","shortcode","select","execCommand","validator","validate","formid","_action2","keyup","change","sitekey","ready","e","loaded","allevents","formdefinition","map","index","require","eventjs"],"mappings":"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","sourcesContent":["/*\n * To change this license header, choose License Headers in Project Properties.\n * To change this template file, choose Tools | Templates\n * and open the template in the editor.\n */\ndefine(['jquery', 'core/ajax', 'core/templates', 'local_edwiserform/form_styles', 'local_edwiserform/iefixes', 'local_edwiserform/efb_form_basic_settings', 'local_edwiserform/formbuilder', 'local_edwiserform/fastsearch', 'local_edwiserform/fastselect'], function ($, ajax, Templates, formStyles) {\n    var SELECTORS = {\n        FORMTYPE: '#id_type',\n        COMPONENT: 'local_edwiserform',\n        EVENT: '#id_events',\n        EVENT_LIST: '.efb-event-list',\n        FORM_STYLE: '.efb-form-style',\n        RENDER_FORM: '.render-form',\n        PANEL: '.efb-panel-btn',\n        TEMPLATE_OVERLAY: '.template-overlay',\n        TITLE: '#id_title',\n        ACTIVE: 'active',\n        FORM_TITLE: '#efb-form-title',\n        TEMPLATES_ROOT: '.efb-forms-setup-templates'\n    };\n    var CONSTANTS = {\n        FORM_UPDATE : 1,\n        FORM_OVERITE : 2,\n        UPDATE_FAILED : 3\n    };\n    var formeo;\n    var container = document.querySelector('.build-form');\n    var renderContainer = document.querySelector(SELECTORS.RENDER_FORM);\n    var saved = false;\n    var fastselect = null;\n    var formeoOpts = {\n        container: container,\n        countries: countries,\n        license: license,\n        svgSprite: M.cfg.wwwroot + '/local/edwiserform/pix/formeo-sprite.svg',\n        localStorage: false,\n    };\n    var eventsLoaded = document.createEvent('Event');\n    eventsLoaded.initEvent('eventsLoaded', true, true);\n    window.eventlist = [];\n\n    var PROMISES = {\n        /**\n         * Call moodle service edwiser_get_template\n         * @param  {String}  type Type of form\n         * @return {Promise}      Ajax promise call\n         */\n        GET_TEMPLATE: function(type) {\n            return ajax.call([{\n                methodname: 'edwiserform_get_template',\n                args: {\n                    name: type\n                }\n            }])[0];\n        },\n        /**\n         * Call moodle service edwiser_get_template\n         * @param  {String}  event Event name\n         * @param  {Number}  id    Form id\n         * @return {Promise}       Ajax promise call\n         */\n        GET_EVENT_SETTINGS: function(event, id) {\n            return ajax.call([{\n                methodname: 'edwiserform_get_event_settings',\n                args: {\n                    event: event,\n                    id: id\n                }\n            }])[0];\n        },\n        /**\n         * Call moodle service edwiser_get_template\n         * @param  {Object}  settings JSON form settings\n         * @param  {String}  formdef  JSON form definition\n         * @return {Promise}          Ajax promise call\n         */\n        CREATE_NEW_FORM: function(settings, formdef) {\n            return ajax.call([{\n                methodname: \"edwiserform_create_new_form\",\n                args: {\n                    setting: settings,\n                    formdef: formdef.toString()\n                }\n            }])[0];\n        },\n        /**\n         * Call moodle service edwiser_get_template\n         * @param  {Object}  settings form settings object\n         * @param  {String}  formdef  JSON form definition\n         * @return {Promise}          Ajax promise call\n         */\n        UPDATE_FORM: function(settings, formdef) {\n            return ajax.call([{\n                methodname: \"edwiserform_update_form_settings\",\n                args: {\n                    setting: settings,\n                    formdef: formdef.toString()\n                }\n            }])[0];\n        }\n    };\n\n    var TEMPLATES = {\n        /**\n         * Call moodle template event_settings_container\n         * @param  {String} event Event type\n         * @param  {String} name  Event name\n         * @return {Promise}      Ajax promise call\n         */\n        SETTINGS_CONTAINER: function(event, name) {\n            var obj = {\n                event: event,\n                name: name\n            }\n            return Templates.render('local_edwiserform/event_settings_container', obj);\n        }\n    }\n\n    /**\n     * Reset form callback\n     */\n    var reset_form = function() {\n        formeo.dom.loading();\n        var formtype = $(SELECTORS.FORMTYPE).val();\n        PROMISES.GET_TEMPLATE(formtype)\n        .done(function(response) {\n            formeo.dom.loadingClose();\n            if (response.status == true) {\n                formeoOpts.container = container;\n                formeo = new Formeo(formeoOpts, response.definition);\n                $(SELECTORS.EVENT).val().forEach(function(event) {\n                    if (window.eventlist[event].hasOwnProperty('has_required_fields') && window.eventlist[event].has_required_fields()) {\n                        add_event_required_fields(event);\n                    }\n                });\n                return;\n            }\n        }).fail(function(ex) {\n            formeo.dom.loadingClose();\n            formeo.dom.alert('danger', ex.message);\n        });\n    };\n    formeoOpts.resetForm = reset_form;\n    formeoOpts.resetable = $(SELECTORS.FORMTYPE).val() != 'blank';\n\n    /**\n     * Return callback for fastselect library option\n     * @return {Object} Callback object\n     */\n    var fastselect_custom_callbacks = {\n        removeSelectedOption: function(option, $choiceItem) {\n            if (option.value == $(SELECTORS.FORMTYPE).val()) {\n                formeo.dom.toaster(M.util.get_string('efb-cannot-remove-event', SELECTORS.COMPONENT, $(SELECTORS.FORMTYPE).find('option:selected').html()), 3000);\n                return;\n            }\n            var removedModel = this.optionsCollection.removeSelected(option);\n            if (removedModel && removedModel.$item) {\n                removedModel.$item.removeClass(this.options.itemSelectedClass);\n            }\n            if ($choiceItem) {\n                $choiceItem.remove();\n            } else {\n                this.$el.find(selectorFromClass(this.options.choiceItemClass) + '[data-value=\"' + option.value + '\"]').remove();\n            }\n            this.updateDomElements();\n            this.writeToInput();\n            $('#efb-event-' + option.value).remove();\n        },\n        setSelectedOption: function(option) {\n            if (this.optionsCollection.isSelected(option.value)) {\n                return;\n            }\n            if (typeof window.eventlist[option.value] == 'undefined') {\n                formeo.dom.alert('danger', M.util.get_string('efb-technical-issue-reload', SELECTORS.COMPONENT), function() {\n                    window.location.reload();\n                });\n                return;\n            }\n            if (window.eventlist[option.value].hasOwnProperty('has_required_fields') && window.eventlist[option.value].has_required_fields()) {\n                add_event_required_fields(option.value);\n            }\n            this.optionsCollection.setSelected(option);\n            var selectedModel = this.optionsCollection.findWhere(function(model) {\n                return model.value === option.value;\n            });\n            if (this.isMultiple) {\n                this.$controls && this.addChoiceItem(option);\n            } else {\n                this.fastsearch && this.fastsearch.$resultItems.removeClass(this.options.itemSelectedClass);\n                this.$toggleBtn && this.$toggleBtn.text(option.text);\n            }\n            selectedModel && selectedModel.$item.addClass(this.options.itemSelectedClass);\n            this.updateDomElements();\n            pluginhassetting.forEach(function(plugin) {\n                if(option.value == plugin) {\n                    get_event_settings(plugin)\n                    .done(function(response) {\n                        TEMPLATES.SETTINGS_CONTAINER(plugin, option.text)\n                        .done(function(html, js) {\n                            Templates.appendNodeContents($(SELECTORS.EVENT_LIST), html, js);\n                            $('#efb-event-' + plugin + ' .efb-event-settings').html(response.settings);\n                            if (response.status == true && window.eventlist[plugin].hasOwnProperty('init')) {\n                                window.eventlist[plugin].init();\n                            }\n                        });\n                    });\n                }\n            });\n        }\n    }\n\n    /**\n     * Check whether form definition is empty or not\n     * @return {Boolean} Return true is definition is empty\n     */\n    function empty_form_definition() {\n        formdef = JSON.parse(get_form_def());\n        return Object.keys(formdef.fields).length == 0;\n    }\n\n    /**\n     * Check whether form preview can be seen and toggle preview button\n     */\n    function can_see_preview() {\n        var emptyform = empty_form_definition();\n        $('#efb-form-preview').toggleClass('d-none', emptyform);\n        $('.efb-form-step-preview').toggleClass('d-none', emptyform);\n    }\n\n    /**\n     * Get form definition from formeo object\n     * @return {String} JSON form data\n     */\n    function get_form_def() {\n        return formeo.formData;\n    }\n\n    /**\n     * Check whether admin/teacher can save current form\n     * @return {Boolean} True is admin/teacher can save form\n     */\n    function can_save_form() {\n        var status = check_template() && check_title(false) && !empty_form_definition();\n        $('#efb-btn-save-form-settings').parents('.efb-editor-button').toggleClass('d-none', !status);\n        $('.efb-form-save').toggleClass('d-none', !status);\n        return status;\n    };\n\n    /**\n     * Get event settings\n     * @param {String}   event    Event name\n     */\n    function get_event_settings(event) {\n        var id = $(\"[name='id']\").val();\n        var promise = PROMISES.GET_EVENT_SETTINGS(event, id != '' ? id : null)\n        promise.fail(function(ex) {\n            formeo.dom.loadingClose();\n            console.log(ex);\n        });\n        return promise;\n    }\n\n    /**\n     * Is template is selected or not\n     * @return {Boolean} True is template selected\n     */\n    function check_template() {\n        return $(SELECTORS.TEMPLATES_ROOT).find('.template.active').length > 0;\n    }\n\n    /**\n     * Switch panel using panel id\n     * @param {String} id Panel id\n     */\n    function switch_panel(id) {\n        $(SELECTORS.PANEL).removeClass(SELECTORS.ACTIVE);\n        $('#efb-' + id).addClass(SELECTORS.ACTIVE);\n        $('.efb-tabcontent').removeClass(SELECTORS.ACTIVE);\n        $('#efb-cont-' + id).addClass(SELECTORS.ACTIVE);\n    }\n\n    /**\n     * Check form title\n     * @param  {Boolean} showError If true then error will be shown\n     * @return {Boolean}           If title is not empty then return true\n     */\n    function check_title(showError) {\n        if (showError == undefined) {\n            showError = true;\n        }\n        settings = get_form_settings();\n        var active = $(SELECTORS.PANEL + '.' + SELECTORS.ACTIVE).attr('id');\n        var emptytitle = settings.title != '';\n        if (!showError) {\n            return emptytitle;\n        }\n        if (!emptytitle) {\n            switch(active) {\n                case 'efb-form-setup':\n                case 'efb-form-builder':\n                case 'efb-form-preview':\n                    switch_panel('form-settings');\n                case 'efb-form-settings':\n                    $(SELECTORS.TITLE).parents('.fitem').addClass('has-danger');\n                    break;\n            }\n            formeo.dom.toaster(M.util.get_string('efb-lbl-title-warning', SELECTORS.COMPONENT), 3000);\n        } else {\n            $('.efb-form-title-container').removeClass('has-danger');\n            $(SELECTORS.TITLE).parents('.fitem').removeClass('has-danger');\n        }\n        return emptytitle;\n    }\n\n    /**\n     * Get event settings container\n     * @param  {String} event Event type\n     * @param  {String} name  Event name\n     * @return {String}       Event settings container\n     */\n    function get_event_settings_container(event, name) {\n        let container = '<div class=\"efb-event collapsed\" id=\"efb-event-' + event + '\">';\n        container += '<h4 class=\"efb-event-label btn-primary\" data-event=\"' + event + '\">';\n        container += name;\n        container += '<i class=\"fa fa-plus\"></i>';\n        container += '<i class=\"fa fa-minus\"></i>';\n        container += '</h4>';\n        container += '<div class=\"efb-event-settings\"></div>';\n        container += '</div>';\n        return container;\n    }\n\n    /**\n     * Toogle event setting on event ribbon click\n     * @param {DOM}     _this        Clicked DOM element\n     * @param {Boolean} collapseOnly True if only one event settings can be uncollapsed\n     */\n    function toggleEventSettings(_this, collapseOnly) {\n        if($(_this).parent('.efb-event').hasClass('collapsed')) {\n            if (!collapseOnly) {\n                $('.efb-event:not(.collapsed) h4').each(function(i, node) {\n                    $(node).trigger('click', [true])\n                });\n            }\n            $(_this).parent('.efb-event').removeClass('collapsed');\n            $(_this).next().height('auto');\n            let height = $(_this).next()[0].clientHeight + 'px';\n            $(_this).next().height('0px');\n            setTimeout(function() {\n                $(_this).next().height(height);\n            }, 0);\n        } else {\n            $(_this).next().height('0px');\n            $(_this).next()[0].addEventListener('transitionend', function() {\n                $(_this).parent('.efb-event').addClass('collapsed');\n            }, {once: true});\n        }\n    }\n\n    /**\n     * Add event required fields in the form\n     * @param {String} name Name of template\n     */\n    add_event_required_fields = function(name) {\n        PROMISES.GET_TEMPLATE(name).done(function(response) {\n            if (response.status == true) {\n                var formData = JSON.parse(response.definition);\n                Object.keys(formData.fields).forEach(function(field) {\n                    if (formData.fields[field].hasOwnProperty('attrs') &&\n                        formData.fields[field].attrs.hasOwnProperty('required') &&\n                        formData.fields[field].attrs.required &&\n                        formData.fields[field].hasOwnProperty('attrs') &&\n                        formData.fields[field].attrs.hasOwnProperty('name') &&\n                        !formeo.dom.hasFieldWithName(formData.fields[field].attrs.name)\n                        ) {\n                        delete formData.fields[field].attrs.template;\n                        formeo.addMissingField(formData.fields[field]);\n                    }\n                });\n            }\n        }).fail(function(ex) {\n            $('[data-template=\"' + name + '\"]').parents(SELECTORS.TEMPLATE_OVERLAY).removeClass('loading');\n            formeo.dom.alert('danger', ex.message);\n        });\n    }\n\n    /**\n     * Get date from form settings\n     * @param  {String} id Date element id\n     * @return {Number}    Date in unix timestamp format\n     */\n    function get_date(id) {\n        if ($(id + '_enabled').is(':checked')) {\n            let datetime = $(id + '_year').val();\n            datetime += '/' + $(id + '_month').val();\n            datetime += '/' + $(id + '_day').val();\n            datetime += ' ' + $(id + '_hour').val();\n            datetime += ':' + $(id + '_minute').val() + ':00';\n            return (new Date(datetime)).getTime() / 1000;\n        }\n        return 0;\n    }\n\n    /**\n     * Get form settings from Moodle form\n     * @param  {Boolean} getEventsSettings If true then event settings will be returned along with main settings\n     * @return {Object}                    Form settings\n     */\n    function get_form_settings(getEventsSettings = false) {\n        var type = $(SELECTORS.FORMTYPE).val();\n        var selectedevents = $(SELECTORS.EVENT).val();\n        var data = {\n            \"title\": $(SELECTORS.TITLE).val(),\n            \"description\": $(\"#id_description\").val(),\n            \"type\": type,\n            \"events\": selectedevents.join(),\n            \"enable_notifi_email\": $(\"#id_enable_notification\").prop('checked'),\n            \"notifi_email\": $(\"#id_notifi_email\").val(),\n            \"notifi_email_subject\": $(\"#id_notifi_email_subject\").val(),\n            \"notifi_email_body\": $(\"#id_notifi_email_body\").val(),\n            \"emailbodydraftitemid\": $('[name=\"notifi_email_body[itemid]\"]').val(),\n            \"confirmation_subject\": $(\"#id_confirmation_subject\").val(),\n            \"confirmation_message\": $(\"#id_confirmation_msg\").val(),\n            \"msgdraftitemid\": $('[name=\"confirmation_msg[itemid]\"]').val(),\n            \"data_edit\": $(\"#id_editdata\").prop('checked'),\n            \"style\": selectedStyle,\n            \"allowsubmissionsfromdate\": get_date('#id_allowsubmissionsfromdate'),\n            \"allowsubmissionstodate\": get_date('#id_allowsubmissionstodate'),\n            \"eventsettings\": \"\"\n        };\n        if (getEventsSettings == true) {\n            var eventsettings = {};\n            selectedevents.forEach(function(event) {\n                pluginhassetting.forEach(function(plugin) {\n                    if (event == plugin) {\n                        eventsettings[event] = window.eventlist[event].get_settings();\n                    }\n                });\n            });\n            data.eventsettings = JSON.stringify(eventsettings);\n        }\n        return data;\n    }\n\n    /**\n     * Call ajax service to save form settings\n     * @param {String}   action     Service name\n     * @param {Object}   settings   Form settings\n     * @param {String}   formdef    Form definition\n     * @param {Function} callable   Callback function\n     */\n    function save_form_settings(action, settings, formdef, callable) {\n        formeo.dom.loading();\n        (action == 'create' ? PROMISES.CREATE_NEW_FORM(settings, formdef) : PROMISES.UPDATE_FORM(settings, formdef))\n        .done(callable).fail(function (ex) {\n            formeo.dom.loadingClose();\n            formeo.dom.alert('danger', ex.message);\n        });\n    }\n\n    /**\n     * Select template using template name and template data\n     * @param {String} formtype Form/template type\n     * @param {String} template Template definition\n     */\n    function select_template(formtype, template = \"\") {\n        formeoOpts.resetable = formtype != 'blank';\n        $(SELECTORS.FORMTYPE).val(formtype);\n\n        // Triggering change event.\n        var changeEvent = new CustomEvent(\"change\", {target: $(SELECTORS.FORMTYPE)[0]});\n        $(SELECTORS.FORMTYPE)[0].dispatchEvent(changeEvent);\n        var events = [];\n        events.push(formtype);\n        $(SELECTORS.EVENT).val(events);\n\n        // Triggering change event.\n        var changeEvent = new CustomEvent(\"change\", {target: $(SELECTORS.EVENT)[0]});\n        $(SELECTORS.EVENT)[0].dispatchEvent(changeEvent);\n        fastselect.destroy();\n        fastselect.init($(SELECTORS.EVENT), $(SELECTORS.EVENT).val());\n        initializeTemplate();\n        formeoOpts.container = container;\n        formeo = new Formeo(formeoOpts, template);\n        $(\"#efb-form-settings\").trigger('click');\n    }\n\n    /**\n     * Show template warning if license is not active\n     * @param {DOM} target DOM target template element\n     */\n    function show_target_warning(target) {\n        formeo.dom.multiActions(\n            'warning',\n            M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n            M.util.get_string(\"efb-template-inactive-license\", SELECTORS.COMPONENT, $(target).data('template-name')),\n            [{\n                title: M.util.get_string('activatelicense', SELECTORS.COMPONENT),\n                type: 'success',\n                action: function() {\n                    window.location.href = M.cfg.wwwroot + '/admin/settings.php?section=local_edwiserform&activetab=local_edwiserform_license_status';\n                }\n            }, {\n                title: M.util.get_string('cancel', SELECTORS.COMPONENT),\n                type: 'warning'\n            }]\n        );\n    }\n\n    /**\n     * Change heading of top bar\n     * @param {String} formName Form name/title\n     */\n    function change_heading(formName) {\n        $(\".efb-editor-action\").toggleClass(\"efb-hide\", formName.length < 0);\n        if (formName.length < 0) {\n            $(\"#id_error_template_title\").show();\n        } else {\n            $(\"#id_error_template_title\").hide();\n        }\n        if (formName.length > 33) {\n            formName = formName.substr(0, 30) + '...';\n        }\n        $(\".efb-form-title\").text(formName);\n    }\n\n    /**\n     * Initialize template and events associated with it\n     */\n    function initializeTemplate() {\n        // Initialise event settings.\n        $(SELECTORS.FORMTYPE).closest('.fitem').hide();\n        if ($(SELECTORS.EVENT_LIST).length == 0) {\n            $('#efb-settings-events').append('<div class=\"efb-event-list\"></div>');\n        } else {\n            $(SELECTORS.EVENT_LIST).empty();\n        }\n        let label = $('#id_allowsubmissionsfromdate_enabled').parent();\n        let container = $(label).parent();\n        label.detach().prependTo(container);\n        label = $('#id_allowsubmissionstodate_enabled').parent();\n        container = $(label).parent();\n        label.detach().prependTo(container);\n        $(SELECTORS.EVENT).val().forEach(function(event) {\n            pluginhassetting.forEach(function(plugin) {\n                if(event == plugin) {\n                    get_event_settings(event)\n                    .done(function(response) {\n                        TEMPLATES.SETTINGS_CONTAINER(event, $(SELECTORS.EVENT).find('option[value=\"' + event + '\"]').html())\n                        .done(function(html, js) {\n                            Templates.appendNodeContents($(SELECTORS.EVENT_LIST), html, js);\n                            $('#efb-event-' + event + ' .efb-event-settings').html(response.settings);\n                            if (typeof window.eventlist[event] == 'undefined') {\n                                formeo.dom.alert('danger', M.util.get_string('efb-technical-issue-reload', SELECTORS.COMPONENT), function() {\n                                    window.location.reload();\n                                });\n                                return;\n                            }\n                            if (response.status == true && window.eventlist[event].hasOwnProperty('init')) {\n                                window.eventlist[event].init();\n                            }\n                        });\n                    });\n                }\n            });\n        });\n        if (fastselect == null) {\n            fastselect = $(SELECTORS.EVENT).hide().fastselect({\n                callbacks: fastselect_custom_callbacks\n            });\n        }\n    };\n\n    /**\n     * Replace previous template with newly selected template\n     * @param  {DOM} template Currently selected template DOM element\n     */\n    function replace_template(template) {\n        var formtype = $(template).data(\"template\");\n        $(template).parents(SELECTORS.TEMPLATE_OVERLAY).addClass('loading');\n        if (formtype == 'blank') {\n            if (license != 'available') {\n                show_target_warning(template);\n                return;\n            }\n            $(template).parents(SELECTORS.TEMPLATE_OVERLAY).removeClass('loading');\n            select_template(formtype, '');\n            return;\n        }\n        PROMISES.GET_TEMPLATE(formtype).done(function(response) {\n            $(template).parents(SELECTORS.TEMPLATE_OVERLAY).removeClass('loading');\n            if (response.status == true) {\n                select_template(formtype, response.definition);\n                return;\n            }\n            if (response.msg != 'license-inactive') {\n                formeo.dom.alert('warning', response.msg, function() {\n                    select_template(formtype, response.definition);\n                });\n            }\n            show_target_warning(template);\n        }).fail(function(ex) {\n            $(template).parents(SELECTORS.TEMPLATE_OVERLAY).removeClass('loading');\n            formeo.dom.alert('danger', ex.message);\n        });\n    }\n\n    /**\n     * Action to be performed after creating form\n     * @param  {Object} response Ajax response\n     */\n    var form_create_action = function (response) {\n        formeo.dom.loadingClose();\n        if (response.status == true) {\n            window.onbeforeunload = null;\n            saved = true;\n            response.formname = $(SELECTORS.TITLE).val();\n            if (mod_edwiserform_return != undefined && mod_edwiserform_return == true) {\n                 window.opener.local_edwiserform_add_new_form(response);\n                return;\n            }\n            formeo.dom.alert('success', response.msg, function() {\n                formeo.reset();\n                $(location).attr('href', M.cfg.wwwroot + \"/local/edwiserform/view.php?page=listforms\");\n            });\n            setTimeout(function() {\n                $(location).attr('href', M.cfg.wwwroot + \"/local/edwiserform/view.php?page=listforms\");\n            }, 4000);\n        } else {\n            formeo.dom.alert('danger', response.msg);\n        }\n    }\n\n    /**\n     * Action to be performed after updating form\n     * @param  {Object} response Ajax response\n     */\n    var form_update_action = function (response) {\n        formeo.dom.loadingClose();\n        if (response.status == CONSTANTS.FORM_UPDATE) {\n            window.onbeforeunload = null;\n            response.formname = $(SELECTORS.TITLE).val();\n            if (mod_edwiserform_return != undefined && mod_edwiserform_return == true) {\n                 window.opener.local_edwiserform_edit_form(response);\n                return;\n            }\n            formeo.dom.multiActions(\n                'success',\n                M.util.get_string(\"success\", SELECTORS.COMPONENT),\n                response.msg,\n                [{\n                    title: M.util.get_string(\"efb-heading-listforms\", SELECTORS.COMPONENT),\n                    type: 'primary',\n                    action: function() {\n                        $(location).attr('href', M.cfg.wwwroot + \"/local/edwiserform/view.php?page=listforms\");\n                    }\n                }, {\n                    title: M.util.get_string(\"close\", SELECTORS.COMPONENT),\n                    type: 'default'\n                }]\n            );\n        } else if (response.status == CONSTANTS.FORM_OVERITE) {\n            var action = \"update\";\n            var formdef = get_form_def();\n            var settings = get_form_settings(true);\n            settings.forceupdate = true;\n            settings.id = $(\"[name='id']\").val();\n            formeo.dom.multiActions(\n                'warning',\n                M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n                response.msg,\n                [{\n                    title: M.util.get_string(\"proceed\", SELECTORS.COMPONENT),\n                    type: 'warning',\n                    action: function() {\n                        save_form_settings(action, settings, formdef, form_update_action);\n                    }\n                }, {\n                    title: M.util.get_string(\"cancel\", SELECTORS.COMPONENT),\n                    type: 'success'\n                }]\n            );\n        } else {\n            formeo.dom.alert('danger', response.msg);\n        }\n    }\n\n    /**\n     * Innitialize form events\n     */\n    function initializeEvents() {\n        $('.efb-form-style-container .controls-toggle').click(function() {\n            $(this).parents('.preview-form').toggleClass('show-styles');\n            $('#efb-cont-form-builder .formeo-controls').closest('.build-form').toggleClass('hidden-controls');\n        });\n        $(SELECTORS.FORM_STYLE).mouseenter(function() {\n            $('.form-style-preview').attr('src', $(this).find('img').attr('src')).css('top', $(this).offset().top).show();\n        }).mouseleave(SELECTORS.FORM_STYLE, function() {\n            $('.form-style-preview').attr('src', '').hide();\n        }).click(SELECTORS.FORM_STYLE, function(event) {\n            $(SELECTORS.FORM_STYLE).removeClass('selected');\n            $(this).addClass('selected');\n            for (var i = 1; i <= supportedStyles; i++) {\n                if ($(SELECTORS.RENDER_FORM).hasClass('form-style-' + i)) {\n                    formStyles.apply($(SELECTORS.RENDER_FORM), 'remove', i);\n                }\n            }\n            selectedStyle = $(this).data('form');\n            formStyles.apply($(SELECTORS.RENDER_FORM), 'add', $(this).data('form'));\n        });\n        $('.efb-settings-tab-list-item').click(function() {\n            if (license != 'available' && $(this).data('target') == 'efb-settings-events') {\n                formeo.dom.multiActions(\n                    'warning',\n                    M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n                    M.util.get_string(\"efb-template-inactive-license\", SELECTORS.COMPONENT, $(this).find('h4').text()),\n                    [{\n                        title: M.util.get_string('activatelicense', SELECTORS.COMPONENT),\n                        type: 'success',\n                        action: function() {\n                            window.location.href = M.cfg.wwwroot + '/admin/settings.php?section=local_edwiserform&activetab=local_edwiserform_license_status';\n                        }\n                    }, {\n                        title: M.util.get_string('cancel', SELECTORS.COMPONENT),\n                        type: 'warning'\n                    }]\n                );\n                return;\n            }\n            $('.efb-settings-tab-list-item').removeClass('active');\n            $(this).addClass('active');\n            $('.efb-settings-tab').removeClass('active');\n            $('#' + $(this).data('target')).addClass('active');\n        });\n        $('.step-navigation #previous-step').click(function () {\n            return;\n        });\n        $('.step-navigation #next-step').click(function () {\n            return;\n        });\n        $(document).on('formeoUpdated', function(event) {\n            var status = can_save_form();\n            can_see_preview();\n            if (!status) {\n                $(SELECTORS.EVENT).val().forEach(function(event) {\n                    if (window.eventlist[event].hasOwnProperty('has_required_fields') && window.eventlist[event].has_required_fields()) {\n                        add_event_required_fields(event);\n                    }\n                });\n            }\n            formeo.dom.toggleImportButton();\n        });\n\n        $(\".efb-form-step\").click(function(event) {\n            event.preventDefault();\n            var id = $(this).data('id');\n            $('#' + id).click();\n        });\n        $(SELECTORS.PANEL).click(function (event) {\n            if (!check_template()) {\n                formeo.dom.toaster(M.util.get_string('efb-select-template-warning', SELECTORS.COMPONENT), 3000);\n                switch_panel('form-setup');\n                event.preventDefault();\n                return;\n            }\n            var id = $(this).attr('id');\n            if (id != 'efb-form-setup' && id != 'efb-form-settings' && !check_title()) {\n                return 0;\n            }\n            can_save_form();\n            var eleCont = $(this).data(\"panel\");\n            $(\"#efb-form-settings, #efb-form-builder, #efb-form-preview, #efb-form-setup\").removeClass(SELECTORS.ACTIVE);\n            $(\"#efb-cont-form-settings, #efb-cont-form-builder, #efb-cont-form-preview, #efb-cont-form-setup\").removeClass(SELECTORS.ACTIVE);\n\n            $(eleCont).addClass(SELECTORS.ACTIVE);\n            $(this).addClass(SELECTORS.ACTIVE);\n            $(\".efb-forms-panel-heading\").text($(this).data(\"panel-lbl\"));\n\n            if (\"#efb-cont-form-preview\" == eleCont) {\n                formeo.render(renderContainer);\n                for (var i = 1; i <= supportedStyles; i++) {\n                    if ($(SELECTORS.RENDER_FORM).hasClass('form-style-' + i)) {\n                        formStyles.apply($(SELECTORS.RENDER_FORM), 'remove', i);\n                    }\n                }\n                formStyles.apply($(SELECTORS.RENDER_FORM), 'add', selectedStyle);\n            }\n        });\n\n        $('body').on('click', '.efb-event-label', function(event, collapseOnly = null) {\n            if ($(this).next().html() == '') {\n                return\n            }\n            toggleEventSettings(this, collapseOnly);\n        })\n        // Copy email tag.\n        .on('click', '.efb-email-tag', function() {\n            var temp = $('<input>');\n            $('body').append(temp);\n            var shortcode = $(this).text();\n            temp.val(shortcode).select();\n            document.execCommand('copy');\n            temp.remove();\n            formeo.dom.toaster(M.util.get_string('shortcodecopied', SELECTORS.COMPONENT, shortcode), 3000);\n        })\n        // This will save the form settings using ajax.\n        .on(\"click\", \"#efb-btn-save-form-settings\", function (event) {\n            if (!check_template()) {\n                formeo.dom.toaster(M.util.get_string('efb-select-template-warning', SELECTORS.COMPONENT), 3000);\n                switch_panel('form-setup');\n                event.preventDefault();\n                return;\n            }\n            if (!check_title() || !formeo.validator.validate()) {\n                return;\n            }\n            var settings = get_form_settings(true);\n            if (settings.allowsubmissionsfromdate >= settings.allowsubmissionstodate && settings.allowsubmissionstodate != 0) {\n                $('#id_allowsubmissionstodate_calendar').parent('.fdate_time_selector').next().show().text(M.util.get_string('allowsubmissionscollapseddate', SELECTORS.COMPONENT)).parents('.form-group.row.fitem').addClass('has-danger');\n                return;\n            } else {\n                $('#id_allowsubmissionstodate_calendar').parent('.fdate_time_selector').next().show().text('').parents('.form-group.row.fitem').removeClass('has-danger');\n            }\n            var formdef = get_form_def();\n            var formid = $(\"[name='id']\").val();\n            var action = \"create\";\n            if (formid) {\n                formeo.dom.multiActions(\n                    'warning',\n                    M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n                    M.util.get_string(\"efb-forms-update-confirm\", SELECTORS.COMPONENT),\n                    [{\n                        title: M.util.get_string(\"efb-forms-update-create-new\", SELECTORS.COMPONENT),\n                        type: 'primary',\n                        action: function() {\n                            save_form_settings(action, settings, formdef, form_create_action);\n                        }\n                    }, {\n                        title: M.util.get_string(\"efb-forms-update-overwrite-existing\", SELECTORS.COMPONENT),\n                        type: 'warning',\n                        action: function() {\n                            action = \"update\";\n                            settings[\"id\"] = formid;\n                            save_form_settings(action, settings, formdef, form_update_action);\n                        }\n                    }]\n                );\n                return;\n            }\n            if (!saved) {\n                save_form_settings(action, settings, formdef, form_create_action);\n            } else {\n                formeo.dom.toaster(M.util.get_string('efb-form-setting-saved', SELECTORS.COMPONENT), 3000);\n            }\n        });\n\n        $(SELECTORS.FORM_TITLE).keyup(function () {\n            var formName = $(this).val();\n            var empty = formName == '';\n            $(this).parent().toggleClass('has-danger', empty);\n            $(SELECTORS.TITLE).val(formName);\n            change_heading(formName);\n        }).change(function() {\n            can_save_form();\n        });\n        $(SELECTORS.TITLE).keyup(function () {\n            var formName = $(this).val();\n            $(SELECTORS.TITLE).val(formName);\n            change_heading(formName);\n        }).change(function() {\n            var formName = $(this).val();\n            $(SELECTORS.FORM_TITLE).val(formName);\n            can_save_form();\n        });\n\n        $(SELECTORS.FORMTYPE).change(function() {\n            $(SELECTORS.TEMPLATES_ROOT).find(\".template\").removeClass(\"active\");\n            var type = $(this).val();\n            $(SELECTORS.TEMPLATES_ROOT).find(\"#template-\" + type).addClass(\"active\");\n            $('#id_registration-enabled').prop('checked', true);\n        });\n        $(SELECTORS.TEMPLATES_ROOT).find(\".template-select\").click(function(event){\n            var _this = this;\n            if ($(this).data('pro') == true && license != 'available') {\n                show_target_warning(this);\n                return;\n            }\n            can_save_form();\n            if ($(SELECTORS.TEMPLATES_ROOT).find(\".template.active\").length && !empty_form_definition()) {\n                formeo.dom.multiActions(\n                    'warning',\n                    M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n                    M.util.get_string(\"efb-template-change-warning\", SELECTORS.COMPONENT),\n                    [{\n                        title: M.util.get_string('proceed', SELECTORS.COMPONENT),\n                        type: 'warning',\n                        action: function() {\n                            replace_template(_this);\n                        }\n                    }, {\n                        title: M.util.get_string('cancel', SELECTORS.COMPONENT),\n                        type: 'success'\n                    }]\n                );\n            } else {\n                replace_template(_this);\n            }\n        });\n        $(document).on('formeoLoaded', function(event) {\n            can_see_preview();\n        });\n        document.addEventListener('eventsLoaded', function() {\n            initializeTemplate();\n            can_save_form();\n            formeo.dom.loadingClose();\n        });\n    }\n\n    /**\n     * Load all plugin js which support form settings to use further\n     */\n    function load_plugin_js() {\n        let loaded = 0;\n        var allevents = $(SELECTORS.EVENT).find('option').map(function(index , event) {\n            return event.value;\n        });\n        if (allevents.length > 0) {\n            allevents.each(function(index, plugin) {\n                require(['edwiserformevents_' + plugin + '/settings'], function(eventjs) {\n                    window.eventlist[plugin] = eventjs;\n                    if (allevents.length == ++loaded) {\n                        $('.efb-form-builder-wrap').show();\n                        initializeEvents();\n                        document.dispatchEvent(eventsLoaded);\n                    }\n                });\n            });\n            return;\n        }\n        initializeEvents();\n        $('.efb-form-builder-wrap').show();\n    };\n\n    /**\n     * Main method which call when this js is loaded\n     * @param {String} sitekey Google recaptcha Site key\n     */\n    var init = function(sitekey) {\n        $(document).ready(function (e) {\n            formeoOpts.sitekey = sitekey;\n            if (typeof formdefinition != 'undefined') {\n                formeo = new Formeo(formeoOpts, formdefinition);\n            } else {\n                formeo = new Formeo(formeoOpts);\n            }\n            can_see_preview();\n            $('#root-page-loading').hide();\n            formeo.dom.loading();\n            load_plugin_js();\n        });\n    };\n    return {\n        init: init\n    };\n});\n"],"file":"new_form_main.min.js"}
