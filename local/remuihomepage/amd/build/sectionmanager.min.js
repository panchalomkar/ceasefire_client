define(["jquery","core/ajax","core/templates","core/notification","theme_remui/notice","theme_remui/events"],function(e,t,i,n,o,s){let a="";var r=[],c=[];function d(){this.sectioncontainer="#page-site-index .home-sections",this.templateprefix="local_remuihomepage/",this.templateprefix+=e("body").hasClass("remui_lite")?"lite_":""}return d.prototype.setLoadedSection=function(e,t){r[e]=t},d.prototype.getLoadedSection=function(e){return r[e]},d.prototype.setSectionName=function(e){this.name=e},d.prototype.setInstanceid=function(e){this.instanceid=e,a='section[data-instance="'+e+'"]'},d.prototype.templateprefixer=function(e){return this.templateprefix+e},d.prototype.activateLoader=function(t){t=this.getJsonParsedData(t);let i=function(){this.setInstanceid(t.id),this.saveSectionsOrder(),e("body").trigger("scroll"),this.scrollToSection('section[data-instance="'+t.id+'"]')}.bind(this);this.renderTemplate(this.templateprefixer(t.sectionname),t,this.sectioncontainer,i)},d.prototype.scrollToSection=function(t){var i=e(t).offset().top-65;e("html, body").animate({scrollTop:i},1e3)},d.prototype.renderTemplate=function(t,n,o,a){i.render(t,n).then(function(t,r){i.appendNodeContents(o,t,r),e("body").trigger({type:s.SECTION_ADDED,configdata:n}),null!=a&&a()})},d.prototype.getSectionElement=function(t){return!1!==t&&this.setInstanceid(t),e("body").find(a)},d.prototype.playSliderVideo=function(e){var t=this.getSectionElement(e);t.find(".carousel-item:not(.active) video").each(function(e,t){t.pause()}),t.find(".carousel-item.active video").each(function(e,t){t.play()})},d.prototype.renderTemplates=function(t,o){let s=t.pop(),a=this.getJsonParsedData(s);this.setLoadedSection(a.id,s),a.lazyloading=!0,i.render("local_remuihomepage/common",a).done(function(n,s){n=e(n).height(window.innerHeight+"px"),i.appendNodeContents(o,n,s),0==appearanimation&&e("body").trigger("scroll"),this.hideAllSectionsLoader(),jQuery(window).scrollTop(0),0!=t.length&&this.renderTemplates(t,o)}.bind(this)).fail(function(e){this.hideAllSectionsLoader(),n.exception(e)}.bind(this))},d.prototype.getJsonParsedData=function(e){return JSON.parse(e)},d.prototype.addSection=function(){t.call([{methodname:"local_remuihomepage_create_section_instance",args:{sectionname:this.name},done:this.activateLoader.bind(this),fail:n.exception}])},d.prototype.hideAllSectionsLoader=function(){e(".sections-loader-wrapper").removeClass("show"),setTimeout(function(){e(".sections-loader-wrapper").hide(),e(window).trigger("scroll")},300)},d.prototype.showAllSectionsLoader=function(){e(".sections-loader-wrapper").addClass("show").css("display","block")},d.prototype.showSectionLoader=function(t,i){e('.section-loader-wrapper[data-instance="'+t+'"]').toggleClass("d-none",!i)},d.prototype.addAllSections=function(e){e.sections.reverse(),0!=e.sections.length?this.renderTemplates(e.sections,this.sectioncontainer):this.hideAllSectionsLoader()},d.prototype.LoadAllSections=function(){t.call([{methodname:"local_remuihomepage_fetch_all_instances",args:{},done:this.addAllSections.bind(this),fail:function(e){n.exception(e),this.hideAllSectionsLoader()}.bind(this)}])},d.prototype.reloadSection=function(t,o){if(0==t.success)return;let r=JSON.parse(t.context);this.setInstanceid(r.id);let c=e(a);i.render(this.templateprefixer(r.sectionname),r).done(function(t,n){t=e(t),0==appearanimation&&e(t).removeClass("invisible"),i.replaceNode(c,t,n),e("body").trigger({type:s.SECTION_UPDATED,configdata:r}),"slider"==r.sectionname&&this.playSliderVideo(r.id),e("body").trigger("scroll"),null!=o&&o()}.bind(this)).fail(function(e){this.showSectionLoader(this.instanceid,!1),n.exception(e)}.bind(this))},d.prototype.updateSection=function(e,i){this.showSectionLoader(e,!0),t.call([{methodname:"local_remuihomepage_update_section_instance",args:{instanceid:e,jsonformdata:i},done:function(e){o.success(M.util.get_string("sectionupdated","local_remuihomepage"),4e3),this.reloadSection(e,null)}.bind(this),fail:function(t){this.showSectionLoader(e,!1),n.exception(t)}.bind(this)}])},d.prototype.deletionTimer=function(t,i){0==i&&clearInterval(c[t]);var n=this.getSectionElement(!1),o=e(n).find(".cancel-delete-section .section-deletion-timer");c[t]=setInterval(function(){var i=parseInt(e(o).text())-1;e(o).text(i),0==i&&(clearInterval(c[t]),e(n).remove(),this.saveSectionsOrder(),e("body").trigger("scroll"))}.bind(this),1e3)},d.prototype.deleteInstance=function(i,s){if(this.showSectionLoader(i,!0),this.setInstanceid(i),2==s)return this.deletionTimer(i,!1),this.getSectionElement(!1).remove(),this.saveSectionsOrder(),void e("body").trigger("scroll");1==s&&o.success(M.util.get_string("sectiondeleted","local_remuihomepage"),4e3),t.call([{methodname:"local_remuihomepage_delete_section_instance",args:{instanceid:i,action:s},done:function(e){this.reloadSection(e,function(){this.deletionTimer(i,s)}.bind(this)),this.saveSectionsOrder()}.bind(this),fail:function(e){this.showSectionLoader(i,!1),n.exception(e)}.bind(this)}])},d.prototype.getSectionsOrder=function(){let t=e("body").find("section[data-instance]"),i=[];return t.each(function(t,n){e(n).find(".section-delete-overlay")&&i.push(e(n).data("instance"))}),i},d.prototype.saveSectionsOrder=function(){transparentheader&&e("body").toggleClass("has-slider animate-header",e("body").find("section[data-instance]:first-child").is(".section-slider"));let i=this.getSectionsOrder();return t.call([{methodname:"local_remuihomepage_save_sections_order",args:{order:i}}])[0]},d.prototype.reorderSection=function(t,i,o){this.setInstanceid(t);let s=e(a);if(-1!=i||s.is(":first-child")){if(1!=i||s.is(":last-child"))return;s.next().insertBefore(s)}else s.prev().insertAfter(s);0!=o&&this.saveSectionsOrder().fail(function(e){n.exception(e),this.reorderSection(t,-1*i,!1)}.bind(this))},d.prototype.updateVisibility=function(i,o){var s=this.getSectionElement(i).find("button.section-visibility");t.call([{methodname:"local_remuihomepage_update_section_visibility",args:{id:i,visible:o},done:function(t){e(s).data("visible",o),e(s).find(".icon").toggleClass("fa-eye",o),e(s).find(".icon").toggleClass("fa-eye-slash",!o),o?(e(s).attr("title","Hide"),e(s).find(".icon").attr("title","Hide")):(e(s).attr("title","Show"),e(s).find(".icon").attr("title","Show"))}.bind(this),fail:n.exception}])},new d});
//# sourceMappingURL=sectionmanager.min.js.map
