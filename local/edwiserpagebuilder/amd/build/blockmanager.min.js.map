{"version":3,"sources":["blockmanager.js"],"names":["define","$","Ajax","Templates","load","document","ready","epbcustommodal","layoutContainer","blockContainer","epbdeleteblockbtn","epbdeletecardbtn","epblayoutcard","updateBlockContent","ele","islayout","attr","find","removeClass","addClass","call","methodname","args","blockname","done","data","status","updateButton","fail","delete_content","id","element","remove","console","log","button","jQuery","html","on","e","preventDefault","epbclosebutton","this","_this","matches","body","className","match","contextid","edwpageurl","next","val","prepend","empty"],"mappings":"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","sourcesContent":["define(['jquery', 'core/ajax', 'core/templates'], function($, Ajax, Templates){\n\n    const load = () => {\n        $(document).ready(function(){\n            let addblockbutton = \"#epbaddblockbutton\";\n            let epbcustommodal = \"#epb_custom_modal.modal\";\n            let epbclosebutton = epbcustommodal + \" .modal-content .close\";\n            let epbcancelbutton = epbcustommodal + \" .modal-content .cancel\";\n            let epbblockupdatebutton = epbcustommodal + \" .modal-content .blocks-list .card-header .update-content\";\n            let epblayoutupdatebutton = epbcustommodal + \" .modal-content .layout-list .card-header .update-content\";\n            \n            let showLayoutsbutton = epbcustommodal + \" .modal-content .show-layouts\";\n            let showBlocksbutton = epbcustommodal + \" .modal-content .show-blocks\";\n            let layoutContainer = epbcustommodal + \" .modal-body .addblock-modal-body.layout-list\";\n            let blockContainer = epbcustommodal + \" .modal-body .addblock-modal-body.blocks-list\";\n\n            let epbupdateblocklistbtn = epbcustommodal + \" .modal-content .action-buttons-modal .updateblocklist\";\n            let epbupdatelayoutlistbtn = epbcustommodal + \" .modal-content .action-buttons-modal .updatelayoutlist\";\n\n            let epbdeleteblockbtn = blockContainer + \" .card .delete-content\";\n            let epbdeletecardbtn = layoutContainer + \" .card .delete-content\";\n\n            let epblayoutcard = layoutContainer + \" .islayout\";\n\n            $(addblockbutton).on('click', function(){\n                $(epbcustommodal).removeClass('d-none');\n            });\n\n            $(document).on( \"click\", showLayoutsbutton, function() {\n                $(\"#epb_custom_modal .modal-content\").removeClass(\"blocklist\").addClass(\"layoutlist\");\n            });\n            $(document).on( \"click\", showBlocksbutton, function() {\n                $(\"#epb_custom_modal .modal-content\").removeClass(\"layoutlist\").addClass(\"blocklist\"); \n            });\n            \n            $(document).on( \"click\", epblayoutcard + \" a\", function(e) {\n                e.preventDefault();\n            });\n            \n            $(document).on( \"click\", addblockbutton, function() {\n                $(epbcustommodal).removeClass('d-none');\n            });\n\n            $(epbclosebutton + \",\"+ epbcancelbutton).on('click', function(){\n                $(epbcustommodal).addClass('d-none');\n            });\n            $(document).on( \"click\", epbblockupdatebutton, function() {\n                updateBlockContent(this, false);\n            });\n            $(document).on( \"click\", epblayoutupdatebutton, function() {\n                updateBlockContent(this, true);\n            });\n            function updateBlockContent(ele, islayout) {\n                $(ele).attr('disabled', true);\n                $(ele).find('.fa').removeClass('fa-download').addClass(\"fa-refresh rotate\");\n\n                Ajax.call([{\n                    methodname: 'edwiserpagebuilder_update_block_content',\n                    args: {blockname: $(ele).attr(\"data-blockname\"), islayout:islayout},\n                    done: function(data) {\n                        $(ele).find('.fa').removeClass(\"rotate\");\n                        if (data.status == false) {\n                            updateButton(ele);\n                        } else {\n                            $(ele).attr('disabled', false);\n                        }\n                    },\n                    fail:function(){\n                        $(ele).find('.fa').removeClass(\"rotate\");\n                        $(ele).attr('disabled', false);\n                    }\n                }]);\n            }\n            $(document).on( \"click\", epbupdateblocklistbtn, function() {\n                let _this = this;\n\n                var id, matches = document.body.className.match(/(^|\\s)context-(\\d+)(\\s|$)/);\n                if (matches) {\n                    // found the id\n                    var contextid = matches[2];\n                }\n\n                $(_this).attr('disabled', true);\n                $(_this).find('.fa').removeClass('fa-download').addClass(\"fa-refresh rotate\");\n                var edwpageurl = $(_this).next().val();\n\n                Ajax.call([{\n                    methodname: 'edwiserpagebuilder_fetch_blocks_list',\n                    args: {edwpageurl: (edwpageurl != \"0\")? edwpageurl:\"?\", contextid:contextid},\n                    done: function(data) {\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        if (data.status == true) {\n                            $(blockContainer + ' .isblock[data-parentblock=\"edwiseradvancedblock\"]').remove();\n                            $(blockContainer + ' .block-cards').prepend(data.html);\n                            updateButton(_this);\n                        } else {\n                            $(_this).attr('disabled', false);\n                        }\n                    },\n                    fail:function(){\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        $(_this).attr('disabled', false);\n                    }\n                }]);\n            });\n\n            $(document).on( \"click\", epbupdatelayoutlistbtn, function() {\n                let _this = this;\n\n                $(_this).attr('disabled', true);\n                $(_this).find('.fa').removeClass('fa-download').addClass(\"fa-refresh rotate\");\n\n                Ajax.call([{\n                    methodname: 'edwiserpagebuilder_fetch_layout_list',\n                    args: {},\n                    done: function(data) {\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        if (data.status == true) {\n                             $(layoutContainer + ' .block-cards').empty().prepend(data.html);\n                            updateButton(_this);\n                        } else {\n                            $(_this).attr('disabled', false);\n                        }\n                    },\n                    fail:function(){\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        $(_this).attr('disabled', false);\n                    }\n                }]);\n            });\n                \n            $(document).on( \"click\", epbdeleteblockbtn, function() {\n                var id = $(this).data(\"blockid\");\n                delete_content(id, false); // false for block\n            });\n            \n            $(document).on( \"click\", epbdeletecardbtn, function() {\n                var id = $(this).data(\"blockid\");\n                delete_content(id, true);  // true for layout\n            });\n\n            function delete_content(id, islayout) {\n                Ajax.call([{\n                    methodname: 'local_edwiserpagebuilder_delete_block',\n                    args: {id:id, islayout:islayout},\n                    done: function(data) {\n                        if (islayout) {\n                            var element = layoutContainer;\n                        } else {\n                            var element = blockContainer;\n                        }\n                        $(element).find('.data[data-blockid=\"'+ id +'\"]').remove();\n                    },\n                    fail:function(data){\n                        console.log(\"We are failure\");\n                        console.log(data);\n                    }\n                }]);\n            }\n\n            function updateButton(button) {\n                $(button).removeClass('btn-primary').addClass('btn-success');\n                $(button).find('.fa').removeClass('fa-refresh').addClass('fa-check');\n                jQuery(button).find('span').html(\"Updated\");\n            }\n\n        });\n    };\n    return {\n        // init: initialize,\n        load: load\n    };\n});\n"],"file":"blockmanager.min.js"}